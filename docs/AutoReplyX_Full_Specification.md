# AutoReplyX - AI ì†Œì…œ ìë™ì‘ë‹µ SaaS ì „ì²´ ê¸°íšÂ·ì„¤ê³„Â·ê°œë°œ ë¬¸ì„œ

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 ì„œë¹„ìŠ¤ëª…
**AutoReplyX**

### 1.2 ì„œë¹„ìŠ¤ ì •ì˜
ì†Œìƒê³µì¸Â·ì…€ëŸ¬Â·í”„ë¦¬ëœì„œë¥¼ ìœ„í•œ Instagram DM/ëŒ“ê¸€ + KakaoTalk + ë„¤ì´ë²„ í†¡í†¡ ìë™ì‘ë‹µ SaaS

### 1.3 í•µì‹¬ ê°€ì¹˜
- ë°˜ë³µë˜ëŠ” ë¬¸ì˜(ê°€ê²©, ìœ„ì¹˜, ìŠ¤ì¼€ì¤„, ê³„ì¢Œë²ˆí˜¸, ë°°ì†¡ë¬¸ì˜ ë“±)ë¥¼ AI ê¸°ë°˜ ìë™ì‘ë‹µìœ¼ë¡œ ì¦‰ì‹œ ì²˜ë¦¬
- ì˜ˆì•½/ê²¬ì  í˜ì´ì§€ ë§í¬ ìë™ ë°œì†¡ìœ¼ë¡œ ë§¤ì¶œ ì „í™˜ë¥  ì¦ëŒ€
- ì†Œìƒê³µì¸ì˜ ì‹œê°„ ì ˆì•½ ë° ê³ ê° ì‘ëŒ€ í’ˆì§ˆ í–¥ìƒ

### 1.4 íƒ€ê²Ÿ ì‚¬ìš©ì
| ì‚¬ìš©ì ìœ í˜• | íŠ¹ì§• | ì£¼ìš” ë‹ˆì¦ˆ |
|------------|------|----------|
| ì¹´í˜/ìŒì‹ì  | ì˜ì—…ì‹œê°„, ìœ„ì¹˜, ë©”ë‰´ ë¬¸ì˜ ë°˜ë³µ | ìë™ ì•ˆë‚´ |
| ì‡¼í•‘ëª°/ì…€ëŸ¬ | ê°€ê²©, ë°°ì†¡, ì¬ê³  ë¬¸ì˜ | ìë™ì‘ë‹µ + ì£¼ë¬¸ë§í¬ |
| ë¯¸ìš©ì‹¤/ë·°í‹°ìƒµ | ì˜ˆì•½ ë¬¸ì˜ ë¹ˆë²ˆ | ì˜ˆì•½í¼ ì—°ë™ |
| í”„ë¦¬ëœì„œ | ê²¬ì , í¬íŠ¸í´ë¦¬ì˜¤ ë¬¸ì˜ | ê²¬ì í¼ ì—°ë™ |

---

## 2. í•µì‹¬ ê¸°ëŠ¥ ìš”ì•½ (MVP)

### 2.1 ì±„ë„ ì—°ë™
| ê¸°ëŠ¥ | ì„¤ëª… | ìš°ì„ ìˆœìœ„ |
|------|------|---------|
| Instagram Graph API | ì›¹í›… ê¸°ë°˜ DM/ëŒ“ê¸€ ìˆ˜ì‹  | P0 (MVP) |
| Kakao ë¹„ì¦ˆë©”ì‹œì§€ | ì±„ë„ ì±—ë´‡ API ì—°ë™ | P1 |
| ë„¤ì´ë²„ í†¡í†¡ | ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ í†¡í†¡ ë©”ì‹œì§€ API | P1 |
| ì—°ë™ ìƒíƒœ í‘œì‹œ | í† í°, ë§Œë£Œì¼, ì›¹í›… ìƒíƒœ | P0 |

### 2.2 ìë™ì‘ë‹µ ì—”ì§„
| ê¸°ëŠ¥ | ì„¤ëª… | ìš°ì„ ìˆœìœ„ |
|------|------|---------|
| í‚¤ì›Œë“œ ê¸°ë°˜ ê·œì¹™ | ì •í™•ì¼ì¹˜/í¬í•¨ì¼ì¹˜/ì •ê·œì‹ | P0 |
| AI ìë™ìƒì„± ì‘ë‹µ | GPT/Claude ê¸°ë°˜ | P0 |
| ì‹œê°„ëŒ€ë³„ ìë™ì‘ë‹µ | ìš´ì˜ì‹œê°„ ì™¸ ë©”ì‹œì§€ ì²˜ë¦¬ | P1 |
| ì‘ë‹µ ON/OFF ìŠ¤ìœ„ì¹˜ | ì „ì²´/ì±„ë„ë³„/ê·œì¹™ë³„ ì œì–´ | P0 |
| ì¿¨ë‹¤ìš´ ì„¤ì • | ì¤‘ë³µ ì‘ë‹µ ë°©ì§€ (ê¸°ë³¸ 1ì‹œê°„) | P0 |

### 2.3 FAQ í…œí”Œë¦¿ AI ìë™ìƒì„±
- "ë‚´ ë¹„ì¦ˆë‹ˆìŠ¤ ì„¤ëª…" ì…ë ¥ â†’ ê°€ê²©/ìœ„ì¹˜/ì—…ì²´ì†Œê°œ/ë¬¸ì˜ìœ í˜• ìë™ ìƒì„±
- ì—…ì¢…ë³„ í…œí”Œë¦¿ ì œê³µ

### 2.4 ì˜ˆì•½Â·ê²¬ì  í˜ì´ì§€
| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ì‹œê°„ ìŠ¬ë¡¯ ê¸°ë°˜ ì˜ˆì•½ ìº˜ë¦°ë” | ë‚ ì§œ/ì‹œê°„ ì„ íƒ |
| ê²¬ì  ìš”ì²­ í¼ | ì´ë¦„/ì—°ë½ì²˜/ìš”ì²­ì‚¬í•­ |
| ìë™ ë§í¬ ì‚½ì… | ì‘ë‹µ ë©”ì‹œì§€ì— URL ìë™ í¬í•¨ |

### 2.5 ëŒ€ì‹œë³´ë“œ
- ë©”ì‹œì§€ ë¡œê·¸ ë¦¬ìŠ¤íŠ¸
- ê·œì¹™/AI ì‘ë‹µ ì‘ë™ ì´ë ¥
- ê³ ê° ë‹¨ìœ„ íˆìŠ¤í† ë¦¬
- AI ì‚¬ìš©ëŸ‰ í‘œì‹œ

### 2.6 ìš”ê¸ˆì œ
| í”Œëœ | ê°€ê²© | ê¸°ëŠ¥ |
|------|------|------|
| Free | ë¬´ë£Œ | í•˜ë£¨ 20ê±´ ìë™ì‘ë‹µ, Instagramë§Œ |
| Pro | ì›” 9,900ì› | ë¬´ì œí•œ + ì˜ˆì•½í¼ + ë„¤ì´ë²„/ì¹´ì¹´ì˜¤ ì—°ë™ |
| Agency | ì›” 29,900ì› | ë©€í‹°ìƒµ ê´€ë¦¬ + í™”ì´íŠ¸ë¼ë²¨ |

---

## 3. ìƒì„¸ ê¸°ëŠ¥ ëª…ì„¸ì„œ (FDS)

### 3.1 íšŒì›/ì¡°ì§

#### 3.1.1 íšŒì›ê°€ì…
```
í•„ìˆ˜ í•„ë“œ:
- email: string (unique, ì´ë©”ì¼ í˜•ì‹ ê²€ì¦)
- password: string (ìµœì†Œ 8ì, ì˜ë¬¸+ìˆ«ì ì¡°í•©)
- brand_name: string (2-50ì)
- industry: enum (cafe, shopping, beauty, freelance, restaurant, other)

ì„ íƒ í•„ë“œ:
- phone: string
- business_hours: string
- address: string
```

#### 3.1.2 ë¡œê·¸ì¸
```
ì§€ì› ë°©ì‹:
1. ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸
2. Google OAuth 2.0
3. Instagram OAuth (ì±„ë„ ì—°ë™ê³¼ í†µí•©)

ì„¸ì…˜ ê´€ë¦¬:
- JWT í† í° ë°œê¸‰ (Access Token: 1ì‹œê°„, Refresh Token: 7ì¼)
- HttpOnly Cookie ì €ì¥
```

#### 3.1.3 í”„ë¡œí•„ ì •ë³´
```typescript
interface UserProfile {
  id: number;
  email: string;
  brand_name: string;
  industry: string;
  business_hours: string;
  address: string;
  description: string;
  contact_email: string;
  contact_phone: string;
  reservation_slug: string;  // autoreply.app/{slug}
  ai_enabled: boolean;
  ai_tone: 'professional' | 'friendly' | 'formal' | 'casual';
  banned_words: string[];
  subscription_plan: 'free' | 'pro' | 'agency';
  subscription_expires_at: Date;
  created_at: Date;
  updated_at: Date;
}
```

---

### 3.2 ì±„ë„ì—°ë™ (Instagram ìƒì„¸)

#### 3.2.1 Instagram Graph API ì—°ë™ í”Œë¡œìš°

```
[ì—°ë™ í”„ë¡œì„¸ìŠ¤]
1. ì‚¬ìš©ìê°€ "Instagram ì—°ë™í•˜ê¸°" í´ë¦­
2. Facebook Login Dialog í˜¸ì¶œ
   - í•„ìš” ê¶Œí•œ: instagram_basic, instagram_manage_messages, pages_messaging
3. Authorization Code ìˆ˜ì‹ 
4. Access Token êµí™˜ (Short-lived â†’ Long-lived)
5. ì›¹í›… ë“±ë¡ (verify_token ê²€ì¦)
6. channels í…Œì´ë¸”ì— ì €ì¥

[í† í° ê°±ì‹  í”Œë¡œìš°]
- Long-lived Token: 60ì¼ ìœ íš¨
- ë§Œë£Œ 14ì¼ ì „ë¶€í„° ìë™ ê°±ì‹  ì‹œë„ (Cron)
- ê°±ì‹  ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
```

#### 3.2.2 ì›¹í›… ì—”ë“œí¬ì¸íŠ¸ ì •ì˜

```php
// POST /api/webhook/instagram
// ì›¹í›… ìˆ˜ì‹  ì²˜ë¦¬

Request Headers:
- X-Hub-Signature-256: HMAC SHA256 ì„œëª…

Request Body (ë©”ì‹œì§€ ìˆ˜ì‹ ):
{
  "object": "instagram",
  "entry": [
    {
      "id": "INSTAGRAM_BUSINESS_ACCOUNT_ID",
      "time": 1699999999,
      "messaging": [
        {
          "sender": {"id": "SENDER_IGSID"},
          "recipient": {"id": "RECIPIENT_IGSID"},
          "timestamp": 1699999999000,
          "message": {
            "mid": "MESSAGE_ID",
            "text": "ê°€ê²©ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?"
          }
        }
      ]
    }
  ]
}

Request Body (ëŒ“ê¸€ ìˆ˜ì‹ ):
{
  "object": "instagram",
  "entry": [
    {
      "id": "INSTAGRAM_BUSINESS_ACCOUNT_ID",
      "time": 1699999999,
      "changes": [
        {
          "field": "comments",
          "value": {
            "id": "COMMENT_ID",
            "text": "ì˜ˆì•½í•˜ê³  ì‹¶ì–´ìš”",
            "from": {"id": "USER_ID", "username": "user123"},
            "media": {"id": "MEDIA_ID"}
          }
        }
      ]
    }
  ]
}

Request Body (ìŠ¤í† ë¦¬ ë©˜ì…˜):
{
  "object": "instagram",
  "entry": [
    {
      "id": "INSTAGRAM_BUSINESS_ACCOUNT_ID",
      "time": 1699999999,
      "changes": [
        {
          "field": "mentions",
          "value": {
            "media_id": "STORY_ID",
            "comment_id": null
          }
        }
      ]
    }
  ]
}
```

#### 3.2.3 ì›¹í›… ê²€ì¦ (GET)

```php
// GET /api/webhook/instagram?hub.mode=subscribe&hub.challenge=CHALLENGE&hub.verify_token=TOKEN

Response: echo $hub_challenge (200 OK)
```

#### 3.2.4 ì‘ë‹µ ì „ì†¡ API

```php
// Instagram Send Message API
POST https://graph.facebook.com/v18.0/me/messages

Headers:
- Authorization: Bearer {access_token}
- Content-Type: application/json

Body:
{
  "recipient": {"id": "RECIPIENT_IGSID"},
  "message": {"text": "ì‘ë‹µ ë©”ì‹œì§€ ë‚´ìš©"}
}

Rate Limits:
- 200 messages per second per app
- ì‘ë‹µ ìœˆë„ìš°: 24ì‹œê°„ ì´ë‚´ ë©”ì‹œì§€ì—ë§Œ ì‘ë‹µ ê°€ëŠ¥
```

#### 3.2.5 ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹…

```typescript
interface WebhookLog {
  id: number;
  channel: 'instagram' | 'kakao' | 'naver';
  event_type: 'message' | 'comment' | 'mention' | 'verification';
  raw_payload: JSON;
  processed: boolean;
  error_message: string | null;
  created_at: Date;
}
```

---

### 3.3 ìë™ì‘ë‹µ ê·œì¹™ì—”ì§„

#### 3.3.1 ê·œì¹™ ì •ì˜ ìŠ¤í‚¤ë§ˆ

```typescript
interface AutoRule {
  id: number;
  user_id: number;
  name: string;                    // ê·œì¹™ ì´ë¦„
  match_type: 'EXACT' | 'CONTAINS' | 'REGEX';
  keyword: string;                 // í‚¤ì›Œë“œ ë˜ëŠ” ì •ê·œì‹
  response_text: string;           // ì‘ë‹µ í…ìŠ¤íŠ¸
  include_reservation_link: boolean;  // ì˜ˆì•½ ë§í¬ í¬í•¨ ì—¬ë¶€
  include_estimate_link: boolean;     // ê²¬ì  ë§í¬ í¬í•¨ ì—¬ë¶€
  priority: number;                // ìš°ì„ ìˆœìœ„ (ë‚®ì„ìˆ˜ë¡ ë†’ìŒ)
  channels: string[];              // ì ìš© ì±„ë„ ['instagram', 'kakao', 'naver']
  cooldown_minutes: number;        // ì¿¨ë‹¤ìš´ (ë¶„)
  active_hours_start: string;      // í™œì„± ì‹œì‘ ì‹œê°„ (HH:MM)
  active_hours_end: string;        // í™œì„± ì¢…ë£Œ ì‹œê°„ (HH:MM)
  active_days: number[];           // í™œì„± ìš”ì¼ [0=ì¼, 1=ì›”, ..., 6=í† ]
  is_active: boolean;
  created_at: Date;
  updated_at: Date;
}
```

#### 3.3.2 ê·œì¹™ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜

```java
// Java Worker - RuleEngine.java

public class RuleEngine {

    public AutoRule findMatchingRule(String message, String channel, int userId) {
        List<AutoRule> rules = ruleRepository.findActiveRulesByUserAndChannel(userId, channel);

        // ìš°ì„ ìˆœìœ„ ìˆœìœ¼ë¡œ ì •ë ¬
        rules.sort(Comparator.comparingInt(AutoRule::getPriority));

        for (AutoRule rule : rules) {
            // ì‹œê°„ëŒ€ ì²´í¬
            if (!isWithinActiveHours(rule)) continue;

            // ì¿¨ë‹¤ìš´ ì²´í¬
            if (isInCooldown(rule, userId)) continue;

            // ë§¤ì¹­ íƒ€ì…ë³„ ê²€ì‚¬
            boolean matched = switch (rule.getMatchType()) {
                case EXACT -> message.equalsIgnoreCase(rule.getKeyword());
                case CONTAINS -> message.toLowerCase().contains(rule.getKeyword().toLowerCase());
                case REGEX -> Pattern.compile(rule.getKeyword(), Pattern.CASE_INSENSITIVE)
                                     .matcher(message).find();
            };

            if (matched) {
                return rule;
            }
        }

        return null; // AI í´ë°±ìœ¼ë¡œ ì´ë™
    }
}
```

#### 3.3.3 ìš°ì„ ìˆœìœ„ ì²˜ë¦¬ ë¡œì§

```
[ë§¤ì¹­ ìš°ì„ ìˆœìœ„]
1. EXACT ë§¤ì¹­ ê·œì¹™ (ìš°ì„ ìˆœìœ„ ë²ˆí˜¸ ìˆœ)
2. CONTAINS ë§¤ì¹­ ê·œì¹™ (ìš°ì„ ìˆœìœ„ ë²ˆí˜¸ ìˆœ)
3. REGEX ë§¤ì¹­ ê·œì¹™ (ìš°ì„ ìˆœìœ„ ë²ˆí˜¸ ìˆœ)
4. AI í´ë°± ì‘ë‹µ

[ì¶©ëŒ ì²˜ë¦¬]
- ë™ì¼ ìš°ì„ ìˆœìœ„ì˜ ì—¬ëŸ¬ ê·œì¹™ì´ ë§¤ì¹­ë  ê²½ìš° â†’ ë¨¼ì € ìƒì„±ëœ ê·œì¹™ ì ìš©
- ë¡œê·¸ì— "ë‹¤ì¤‘ ë§¤ì¹­ ë°œìƒ" ê¸°ë¡
```

#### 3.3.4 ì¿¨ë‹¤ìš´ ì²˜ë¦¬

```java
// Redis ê¸°ë°˜ ì¿¨ë‹¤ìš´ ê´€ë¦¬
public boolean isInCooldown(AutoRule rule, String senderId) {
    String key = String.format("cooldown:%d:%s", rule.getId(), senderId);
    return redisTemplate.hasKey(key);
}

public void setCooldown(AutoRule rule, String senderId) {
    String key = String.format("cooldown:%d:%s", rule.getId(), senderId);
    redisTemplate.opsForValue().set(key, "1", rule.getCooldownMinutes(), TimeUnit.MINUTES);
}
```

#### 3.3.5 AI í´ë°± ì²˜ë¦¬

```java
public String generateAIResponse(String message, UserProfile user) {
    // ê·œì¹™ì— ë§¤ì¹­ë˜ì§€ ì•Šì€ ê²½ìš° AI ì‘ë‹µ ìƒì„±
    if (!user.isAiEnabled()) {
        return getDefaultFallbackMessage();
    }

    String prompt = buildPrompt(message, user);
    String response = openAIService.generateResponse(prompt);

    // ê¸ˆì§€ì–´ í•„í„°ë§
    response = filterBannedWords(response, user.getBannedWords());

    return response;
}
```

---

### 3.4 AI ì‘ë‹µ ìƒì„±

#### 3.4.1 í”„ë¡¬í”„íŠ¸ êµ¬ì¡°

```json
{
  "system_prompt": "ë‹¹ì‹ ì€ {brand_name}ì˜ ê³ ê° ì‘ëŒ€ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.\n\në¹„ì¦ˆë‹ˆìŠ¤ ì •ë³´:\n- ì—…ì¢…: {industry}\n- ì˜ì—…ì‹œê°„: {business_hours}\n- ì£¼ì†Œ: {address}\n- ì„¤ëª…: {description}\n\nì‘ë‹µ í†¤: {ai_tone}\n\nê·œì¹™:\n1. ê°„ê²°í•˜ê³  ì¹œì ˆí•˜ê²Œ ì‘ë‹µ\n2. 150ì ì´ë‚´ë¡œ ì‘ë‹µ\n3. ê¸ˆì§€ì–´ ì‚¬ìš© ê¸ˆì§€: {banned_words}\n4. í™•ì‹¤í•˜ì§€ ì•Šì€ ì •ë³´ëŠ” 'í™•ì¸ í›„ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤'ë¡œ ì‘ë‹µ",

  "user_message": "{customer_message}",

  "examples": [
    {"role": "user", "content": "ì˜ì—…ì‹œê°„ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?"},
    {"role": "assistant", "content": "ì•ˆë…•í•˜ì„¸ìš”! ì €í¬ ì˜ì—…ì‹œê°„ì€ {business_hours}ì…ë‹ˆë‹¤. ë°©ë¬¸ ì „ ì°¸ê³ í•´ì£¼ì„¸ìš” :)"}
  ]
}
```

#### 3.4.2 FAQ ìë™ìƒì„± í”„ë¡¬í”„íŠ¸

```json
{
  "system_prompt": "ë‹¹ì‹ ì€ ì†Œìƒê³µì¸ ë¹„ì¦ˆë‹ˆìŠ¤ FAQë¥¼ ìƒì„±í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.",

  "user_message": "ë‹¤ìŒ ë¹„ì¦ˆë‹ˆìŠ¤ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ FAQ 5ê°œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”:\n\nì—…ì¢…: {industry}\në¸Œëœë“œëª…: {brand_name}\nì„¤ëª…: {description}\n\nê° FAQëŠ” ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ì„±:\n{\n  \"keyword\": \"í‚¤ì›Œë“œ\",\n  \"response\": \"ì‘ë‹µ í…ìŠ¤íŠ¸\"\n}"
}
```

#### 3.4.3 AI ì‘ë‹µ í†¤ ì„¤ì •

```typescript
const TONE_PROMPTS = {
  professional: "ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê° ìˆëŠ” í†¤ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”. ì¡´ëŒ“ë§ì„ ì‚¬ìš©í•˜ê³  ê²©ì‹ì²´ë¥¼ ìœ ì§€í•˜ì„¸ìš”.",
  friendly: "ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ í†¤ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”. ì´ëª¨í‹°ì½˜ì„ ì ì ˆíˆ ì‚¬ìš©í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.",
  formal: "ê²©ì‹ì„ ì°¨ë¦° ê³µì†í•œ í†¤ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”. ë†’ì„ë§ì„ ì² ì €íˆ ì‚¬ìš©í•˜ì„¸ìš”.",
  casual: "í¸ì•ˆí•˜ê³  ìºì£¼ì–¼í•œ í†¤ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”. ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”ì²´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."
};
```

#### 3.4.4 ê¸ˆì§€ì–´ í•„í„°ë§

```java
public String filterBannedWords(String response, List<String> bannedWords) {
    String filtered = response;
    for (String word : bannedWords) {
        filtered = filtered.replaceAll("(?i)" + Pattern.quote(word), "***");
    }
    return filtered;
}
```

#### 3.4.5 í† í° ë¹„ìš© ì ˆê° ì „ëµ

```
1. ì‘ë‹µ ìºì‹±
   - ë™ì¼ ì§ˆë¬¸(ìœ ì‚¬ë„ 90% ì´ìƒ) â†’ ìºì‹œëœ ì‘ë‹µ ë°˜í™˜
   - ìºì‹œ TTL: 24ì‹œê°„

2. í”„ë¡¬í”„íŠ¸ ìµœì í™”
   - ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìµœì†Œí™”
   - ì˜ˆì‹œ 1-2ê°œë¡œ ì œí•œ

3. ëª¨ë¸ ì„ íƒ
   - ë‹¨ìˆœ ì§ˆë¬¸: GPT-3.5-turbo (ì €ë¹„ìš©)
   - ë³µì¡í•œ ì§ˆë¬¸: GPT-4 (ê³ í’ˆì§ˆ)

4. í† í° ì œí•œ
   - max_tokens: 200
   - ì‘ë‹µ ê¸¸ì´ ì œí•œ: 150ì
```

---

### 3.5 ì˜ˆì•½/ê²¬ì  í˜ì´ì§€

#### 3.5.1 ì˜ˆì•½ í¼ ìŠ¤í‚¤ë§ˆ

```typescript
interface ReservationForm {
  id: number;
  user_id: number;
  slug: string;                    // URL ìŠ¬ëŸ¬ê·¸
  title: string;                   // í˜ì´ì§€ ì œëª©
  description: string;             // ì„¤ëª…
  fields: ReservationField[];      // í¼ í•„ë“œ
  time_slots: TimeSlot[];          // ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„
  notification_email: string;      // ì•Œë¦¼ ìˆ˜ì‹  ì´ë©”ì¼
  notification_sms: string;        // ì•Œë¦¼ ìˆ˜ì‹  SMS
  is_active: boolean;
  created_at: Date;
}

interface ReservationField {
  name: string;
  label: string;
  type: 'text' | 'email' | 'phone' | 'date' | 'time' | 'textarea' | 'select';
  required: boolean;
  options?: string[];              // select íƒ€ì…ì¼ ë•Œ
}

interface TimeSlot {
  day_of_week: number;             // 0-6 (ì¼-í† )
  start_time: string;              // HH:MM
  end_time: string;                // HH:MM
  interval_minutes: number;        // ì˜ˆì•½ ê°„ê²©
  max_bookings_per_slot: number;   // ìŠ¬ë¡¯ë‹¹ ìµœëŒ€ ì˜ˆì•½ ìˆ˜
}
```

#### 3.5.2 ê¸°ë³¸ ì˜ˆì•½ í¼ í•„ë“œ

```typescript
const DEFAULT_RESERVATION_FIELDS: ReservationField[] = [
  { name: 'customer_name', label: 'ì´ë¦„', type: 'text', required: true },
  { name: 'phone', label: 'ì—°ë½ì²˜', type: 'phone', required: true },
  { name: 'email', label: 'ì´ë©”ì¼', type: 'email', required: false },
  { name: 'service', label: 'ì„œë¹„ìŠ¤', type: 'select', required: true, options: [] },
  { name: 'date', label: 'ì˜ˆì•½ ë‚ ì§œ', type: 'date', required: true },
  { name: 'time', label: 'ì˜ˆì•½ ì‹œê°„', type: 'time', required: true },
  { name: 'requests', label: 'ìš”ì²­ì‚¬í•­', type: 'textarea', required: false }
];
```

#### 3.5.3 ê²¬ì  ìš”ì²­ í¼ ìŠ¤í‚¤ë§ˆ

```typescript
interface EstimateForm {
  id: number;
  user_id: number;
  slug: string;
  title: string;
  description: string;
  fields: EstimateField[];
  notification_email: string;
  is_active: boolean;
  created_at: Date;
}

interface EstimateField {
  name: string;
  label: string;
  type: 'text' | 'email' | 'phone' | 'textarea' | 'file' | 'select' | 'checkbox';
  required: boolean;
  options?: string[];
}
```

#### 3.5.4 ì•Œë¦¼ Webhook

```php
// ì˜ˆì•½ ìƒì„± ì‹œ ì•Œë¦¼ ë°œì†¡
class NotificationService {

    public function sendReservationNotification(Reservation $reservation) {
        $user = $reservation->user;

        // ì´ë©”ì¼ ì•Œë¦¼
        if ($user->notification_email) {
            Mail::to($user->notification_email)->send(
                new ReservationNotificationMail($reservation)
            );
        }

        // SMS ì•Œë¦¼ (ì™¸ë¶€ API)
        if ($user->notification_sms) {
            $this->smsService->send(
                $user->notification_sms,
                $this->buildSmsMessage($reservation)
            );
        }

        // Webhook í˜¸ì¶œ (ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™ìš©)
        if ($user->webhook_url) {
            Http::post($user->webhook_url, [
                'event' => 'reservation.created',
                'data' => $reservation->toArray()
            ]);
        }
    }
}
```

#### 3.5.5 ì˜ˆì•½ ë§í¬ ìë™ì‚½ì… ê·œì¹™

```typescript
// ì‘ë‹µ ë©”ì‹œì§€ ìƒì„± ì‹œ
function buildResponseMessage(rule: AutoRule, user: UserProfile): string {
  let message = rule.response_text;

  if (rule.include_reservation_link) {
    const reservationUrl = `https://autoreply.app/${user.reservation_slug}`;
    message += `\n\nğŸ“… ì˜ˆì•½í•˜ê¸°: ${reservationUrl}`;
  }

  if (rule.include_estimate_link) {
    const estimateUrl = `https://autoreply.app/${user.reservation_slug}/estimate`;
    message += `\n\nğŸ“ ê²¬ì  ìš”ì²­: ${estimateUrl}`;
  }

  return message;
}
```

#### 3.5.6 ë°©ë¬¸ URL í†µê³„

```typescript
interface PageVisitStats {
  page_type: 'reservation' | 'estimate';
  user_id: number;
  total_visits: number;
  unique_visitors: number;
  submissions: number;
  conversion_rate: number;  // submissions / unique_visitors
  visits_by_date: { date: string; count: number }[];
  referrer_stats: { source: string; count: number }[];
}
```

---

### 3.6 ë¡œê·¸/ëŒ€ì‹œë³´ë“œ

#### 3.6.1 ë©”ì‹œì§€ ë¡œê·¸ ìŠ¤í‚¤ë§ˆ

```typescript
interface MessageLog {
  id: number;
  user_id: number;
  channel: 'instagram' | 'kakao' | 'naver';
  sender_id: string;              // ë°œì‹ ì í”Œë«í¼ ID
  sender_name: string;            // ë°œì‹ ì í‘œì‹œëª…
  received_message: string;       // ìˆ˜ì‹  ë©”ì‹œì§€
  response_message: string;       // ì‘ë‹µ ë©”ì‹œì§€
  response_type: 'rule' | 'ai' | 'manual' | 'none';
  matched_rule_id: number | null;
  ai_tokens_used: number;
  processing_time_ms: number;
  created_at: Date;
}
```

#### 3.6.2 ëŒ€ì‹œë³´ë“œ í†µê³„ API

```typescript
interface DashboardStats {
  // ì˜¤ëŠ˜ í†µê³„
  today: {
    total_messages: number;
    rule_responses: number;
    ai_responses: number;
    avg_response_time_ms: number;
  };

  // ì´ë²ˆ ë‹¬ í†µê³„
  monthly: {
    total_messages: number;
    rule_responses: number;
    ai_responses: number;
    ai_tokens_used: number;
    ai_cost_estimate: number;
  };

  // ì±„ë„ë³„ í†µê³„
  by_channel: {
    channel: string;
    message_count: number;
    response_rate: number;
  }[];

  // ê·œì¹™ë³„ í†µê³„
  top_rules: {
    rule_id: number;
    rule_name: string;
    trigger_count: number;
  }[];

  // ì¼ë³„ ì¶”ì´
  daily_trend: {
    date: string;
    message_count: number;
  }[];
}
```

#### 3.6.3 CSV Export (Pro ê¸°ëŠ¥)

```php
class LogExportService {

    public function exportToCsv(int $userId, array $filters): string {
        $logs = MessageLog::query()
            ->where('user_id', $userId)
            ->when($filters['start_date'], fn($q) => $q->where('created_at', '>=', $filters['start_date']))
            ->when($filters['end_date'], fn($q) => $q->where('created_at', '<=', $filters['end_date']))
            ->when($filters['channel'], fn($q) => $q->where('channel', $filters['channel']))
            ->orderBy('created_at', 'desc')
            ->get();

        $csv = Writer::createFromString('');
        $csv->insertOne(['ì‹œê°„', 'ì±„ë„', 'ë°œì‹ ì', 'ìˆ˜ì‹  ë©”ì‹œì§€', 'ì‘ë‹µ ë©”ì‹œì§€', 'ì‘ë‹µ íƒ€ì…']);

        foreach ($logs as $log) {
            $csv->insertOne([
                $log->created_at->format('Y-m-d H:i:s'),
                $log->channel,
                $log->sender_name,
                $log->received_message,
                $log->response_message,
                $log->response_type
            ]);
        }

        return $csv->toString();
    }
}
```

---

## 4. ë°±ì—”ë“œ ì•„í‚¤í…ì²˜ ì„¤ê³„ (Java + PHP ì¡°í•©)

### 4.1 ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           í´ë¼ì´ì–¸íŠ¸ (React)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Nginx (ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)                             â”‚
â”‚                    - SSL ì¢…ë£Œ                                            â”‚
â”‚                    - ë¡œë“œë°¸ëŸ°ì‹±                                          â”‚
â”‚                    - Rate Limiting                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PHP API Gateway          â”‚   â”‚      ì •ì  íŒŒì¼ ì„œë²„             â”‚
â”‚      (Laravel 10)             â”‚   â”‚      (React Build)             â”‚
â”‚                               â”‚   â”‚                               â”‚
â”‚   - ì›¹í›… ìˆ˜ì‹                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   - REST API                  â”‚
â”‚   - ì¸ì¦/ì¸ê°€                  â”‚
â”‚   - ìš”ê¸ˆì œ ì²´í¬                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Redis                    â”‚
â”‚   - ë©”ì‹œì§€ í                  â”‚
â”‚   - ì„¸ì…˜ ì €ì¥                  â”‚
â”‚   - ì¿¨ë‹¤ìš´ ìºì‹œ                â”‚
â”‚   - AI ì‘ë‹µ ìºì‹œ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Java Worker              â”‚
â”‚      (Spring Boot)            â”‚
â”‚                               â”‚
â”‚   - ê·œì¹™ì—”ì§„ ì‹¤í–‰              â”‚
â”‚   - AI API í˜¸ì¶œ               â”‚
â”‚   - ì‘ë‹µ ì „ì†¡                  â”‚
â”‚   - ë¡œê·¸ ì €ì¥                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MySQL / MariaDB                               â”‚
â”‚                    - ì‚¬ìš©ì ë°ì´í„°                                      â”‚
â”‚                    - ê·œì¹™ ë°ì´í„°                                        â”‚
â”‚                    - ë¡œê·¸ ë°ì´í„°                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cron Server (Java)       â”‚
â”‚                               â”‚
â”‚   - í† í° ê°±ì‹                   â”‚
â”‚   - í†µê³„ ì§‘ê³„                  â”‚
â”‚   - ì•Œë¦¼ ë°œì†¡                  â”‚
â”‚   - ë¡œê·¸ ì •ë¦¬                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ì»´í¬ë„ŒíŠ¸ë³„ ìƒì„¸

#### 4.2.1 PHP API Gateway (Laravel)

```
/api
â”œâ”€â”€ /auth
â”‚   â”œâ”€â”€ POST /login              # ë¡œê·¸ì¸
â”‚   â”œâ”€â”€ POST /register           # íšŒì›ê°€ì…
â”‚   â”œâ”€â”€ POST /refresh            # í† í° ê°±ì‹ 
â”‚   â””â”€â”€ POST /logout             # ë¡œê·¸ì•„ì›ƒ
â”‚
â”œâ”€â”€ /webhook
â”‚   â”œâ”€â”€ GET  /instagram          # ì›¹í›… ê²€ì¦
â”‚   â”œâ”€â”€ POST /instagram          # ì¸ìŠ¤íƒ€ ì›¹í›… ìˆ˜ì‹ 
â”‚   â”œâ”€â”€ POST /kakao              # ì¹´ì¹´ì˜¤ ì›¹í›… ìˆ˜ì‹ 
â”‚   â””â”€â”€ POST /naver              # ë„¤ì´ë²„ ì›¹í›… ìˆ˜ì‹ 
â”‚
â”œâ”€â”€ /channels
â”‚   â”œâ”€â”€ GET  /                   # ì—°ë™ ì±„ë„ ëª©ë¡
â”‚   â”œâ”€â”€ POST /instagram/connect  # ì¸ìŠ¤íƒ€ ì—°ë™
â”‚   â”œâ”€â”€ DELETE /instagram        # ì¸ìŠ¤íƒ€ ì—°ë™ í•´ì œ
â”‚   â””â”€â”€ GET  /{channel}/status   # ì—°ë™ ìƒíƒœ í™•ì¸
â”‚
â”œâ”€â”€ /rules
â”‚   â”œâ”€â”€ GET  /                   # ê·œì¹™ ëª©ë¡
â”‚   â”œâ”€â”€ POST /                   # ê·œì¹™ ìƒì„±
â”‚   â”œâ”€â”€ PUT  /{id}               # ê·œì¹™ ìˆ˜ì •
â”‚   â”œâ”€â”€ DELETE /{id}             # ê·œì¹™ ì‚­ì œ
â”‚   â””â”€â”€ POST /test               # ê·œì¹™ í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€â”€ /ai
â”‚   â”œâ”€â”€ POST /generate-faq       # FAQ ìë™ìƒì„±
â”‚   â””â”€â”€ POST /test-message       # AI ì‘ë‹µ í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€â”€ /reservations
â”‚   â”œâ”€â”€ GET  /                   # ì˜ˆì•½ ëª©ë¡
â”‚   â”œâ”€â”€ POST /                   # ì˜ˆì•½ ìƒì„± (ê³µê°œ)
â”‚   â”œâ”€â”€ PUT  /{id}/status        # ì˜ˆì•½ ìƒíƒœ ë³€ê²½
â”‚   â””â”€â”€ GET  /settings           # ì˜ˆì•½í¼ ì„¤ì •
â”‚
â”œâ”€â”€ /estimates
â”‚   â”œâ”€â”€ GET  /                   # ê²¬ì  ìš”ì²­ ëª©ë¡
â”‚   â””â”€â”€ POST /                   # ê²¬ì  ìš”ì²­ ìƒì„± (ê³µê°œ)
â”‚
â”œâ”€â”€ /logs
â”‚   â”œâ”€â”€ GET  /                   # ë©”ì‹œì§€ ë¡œê·¸
â”‚   â””â”€â”€ GET  /export             # CSV ë‚´ë³´ë‚´ê¸°
â”‚
â”œâ”€â”€ /dashboard
â”‚   â””â”€â”€ GET  /stats              # ëŒ€ì‹œë³´ë“œ í†µê³„
â”‚
â”œâ”€â”€ /profile
â”‚   â”œâ”€â”€ GET  /                   # í”„ë¡œí•„ ì¡°íšŒ
â”‚   â””â”€â”€ PUT  /                   # í”„ë¡œí•„ ìˆ˜ì •
â”‚
â””â”€â”€ /subscription
    â”œâ”€â”€ GET  /                   # êµ¬ë… ì •ë³´
    â””â”€â”€ POST /upgrade            # í”Œëœ ì—…ê·¸ë ˆì´ë“œ
```

#### 4.2.2 Java Worker (Spring Boot)

```java
// MessageProcessor.java
@Component
public class MessageProcessor {

    @Autowired
    private RuleEngine ruleEngine;

    @Autowired
    private AIService aiService;

    @Autowired
    private ChannelService channelService;

    @Autowired
    private MessageLogRepository logRepository;

    @RabbitListener(queues = "message.queue")
    public void processMessage(IncomingMessage message) {
        long startTime = System.currentTimeMillis();

        try {
            // 1. ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
            User user = userRepository.findByChannelId(message.getRecipientId());

            // 2. ìš”ê¸ˆì œ ì²´í¬
            if (!subscriptionService.canProcess(user)) {
                logRepository.save(createLog(message, null, "quota_exceeded"));
                return;
            }

            // 3. ê·œì¹™ ë§¤ì¹­
            AutoRule matchedRule = ruleEngine.findMatchingRule(
                message.getText(),
                message.getChannel(),
                user.getId()
            );

            String responseText;
            String responseType;
            int tokensUsed = 0;

            if (matchedRule != null) {
                // ê·œì¹™ ë§¤ì¹­ë¨
                responseText = buildRuleResponse(matchedRule, user);
                responseType = "rule";

                // ì¿¨ë‹¤ìš´ ì„¤ì •
                ruleEngine.setCooldown(matchedRule, message.getSenderId());
            } else {
                // AI í´ë°±
                AIResponse aiResponse = aiService.generateResponse(message.getText(), user);
                responseText = aiResponse.getText();
                responseType = "ai";
                tokensUsed = aiResponse.getTokensUsed();
            }

            // 4. ì‘ë‹µ ì „ì†¡
            channelService.sendMessage(
                message.getChannel(),
                user.getChannelToken(message.getChannel()),
                message.getSenderId(),
                responseText
            );

            // 5. ë¡œê·¸ ì €ì¥
            long processingTime = System.currentTimeMillis() - startTime;
            logRepository.save(MessageLog.builder()
                .userId(user.getId())
                .channel(message.getChannel())
                .senderId(message.getSenderId())
                .senderName(message.getSenderName())
                .receivedMessage(message.getText())
                .responseMessage(responseText)
                .responseType(responseType)
                .matchedRuleId(matchedRule != null ? matchedRule.getId() : null)
                .aiTokensUsed(tokensUsed)
                .processingTimeMs((int) processingTime)
                .build());

        } catch (Exception e) {
            log.error("Message processing failed", e);
            logRepository.save(createErrorLog(message, e));
        }
    }
}
```

#### 4.2.3 Redis êµ¬ì¡°

```
# ë©”ì‹œì§€ í
message.queue                           # RabbitMQ/Redis Stream

# ì„¸ì…˜
session:{session_id}                    # ì‚¬ìš©ì ì„¸ì…˜ ë°ì´í„°

# ì¿¨ë‹¤ìš´
cooldown:{rule_id}:{sender_id}          # TTL = cooldown_minutes

# AI ì‘ë‹µ ìºì‹œ
ai_cache:{hash(message)}                # TTL = 24ì‹œê°„

# Rate Limiting
rate:{user_id}:{date}                   # ì¼ì¼ ìš”ì²­ ì¹´ìš´íŠ¸
rate:api:{ip}:{minute}                  # API rate limit

# ì±„ë„ í† í° ìºì‹œ
channel_token:{user_id}:{channel}       # ì±„ë„ ì•¡ì„¸ìŠ¤ í† í°
```

### 4.3 ë©”ì‹œì§€ ì²˜ë¦¬ íë¦„ ìƒì„¸

```
[Step 1] Instagram ì›¹í›… â†’ PHP API Gateway
         â”‚
         â–¼
[Step 2] ì„œëª… ê²€ì¦ (X-Hub-Signature-256)
         â”‚
         â”œâ”€ ì‹¤íŒ¨ â†’ 403 ë°˜í™˜, ë¡œê·¸ ì €ì¥
         â”‚
         â–¼
[Step 3] ì´ë²¤íŠ¸ íƒ€ì… íŒë³„
         â”‚
         â”œâ”€ ë©”ì‹œì§€ â†’ message.queueë¡œ í‘¸ì‹œ
         â”œâ”€ ëŒ“ê¸€ â†’ comment.queueë¡œ í‘¸ì‹œ
         â””â”€ ë©˜ì…˜ â†’ mention.queueë¡œ í‘¸ì‹œ
         â”‚
         â–¼
[Step 4] 200 OK ì¦‰ì‹œ ë°˜í™˜ (3ì´ˆ ì´ë‚´)

         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[Step 5] Java Workerê°€ íì—ì„œ ë©”ì‹œì§€ ì†Œë¹„
         â”‚
         â–¼
[Step 6] ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ + ìš”ê¸ˆì œ ì²´í¬
         â”‚
         â”œâ”€ í• ë‹¹ëŸ‰ ì´ˆê³¼ â†’ ë¡œê·¸ë§Œ ì €ì¥, ì¢…ë£Œ
         â”‚
         â–¼
[Step 7] ê·œì¹™ì—”ì§„ ì‹¤í–‰
         â”‚
         â”œâ”€ ë§¤ì¹­ë¨ â†’ ê·œì¹™ ì‘ë‹µ ìƒì„±
         â”œâ”€ ë¯¸ë§¤ì¹­ + AI í™œì„± â†’ AI ì‘ë‹µ ìƒì„±
         â””â”€ ë¯¸ë§¤ì¹­ + AI ë¹„í™œì„± â†’ ê¸°ë³¸ ì‘ë‹µ ë˜ëŠ” ë¬´ì‘ë‹µ
         â”‚
         â–¼
[Step 8] ì‘ë‹µ ì „ì†¡ API í˜¸ì¶œ
         â”‚
         â”œâ”€ ì„±ê³µ â†’ ë¡œê·¸ ì €ì¥ (response_type = 'rule'/'ai')
         â””â”€ ì‹¤íŒ¨ â†’ ì¬ì‹œë„ íë¡œ ì´ë™ (ìµœëŒ€ 3íšŒ)
         â”‚
         â–¼
[Step 9] ì¿¨ë‹¤ìš´ ì„¤ì • (Redis)
         â”‚
         â–¼
[Step 10] ì™„ë£Œ
```

### 4.4 AI ëª¨ë“ˆ ì„¤ê³„

#### 4.4.1 AI Service êµ¬ì¡°

```java
// AIService.java
@Service
public class AIService {

    private final RestTemplate restTemplate;
    private final RedisTemplate<String, String> redisTemplate;

    private static final String OPENAI_API_URL = "https://api.openai.com/v1/chat/completions";

    public AIResponse generateResponse(String message, User user) {
        // 1. ìºì‹œ í™•ì¸
        String cacheKey = "ai_cache:" + DigestUtils.md5Hex(message + user.getId());
        String cached = redisTemplate.opsForValue().get(cacheKey);
        if (cached != null) {
            return new AIResponse(cached, 0, true);
        }

        // 2. í”„ë¡¬í”„íŠ¸ êµ¬ì„±
        ChatRequest request = ChatRequest.builder()
            .model(selectModel(message))
            .messages(List.of(
                new ChatMessage("system", buildSystemPrompt(user)),
                new ChatMessage("user", message)
            ))
            .maxTokens(200)
            .temperature(0.7)
            .build();

        // 3. API í˜¸ì¶œ
        ChatResponse response = restTemplate.postForObject(
            OPENAI_API_URL,
            request,
            ChatResponse.class
        );

        String responseText = response.getChoices().get(0).getMessage().getContent();

        // 4. ê¸ˆì§€ì–´ í•„í„°ë§
        responseText = filterBannedWords(responseText, user.getBannedWords());

        // 5. ìºì‹œ ì €ì¥
        redisTemplate.opsForValue().set(cacheKey, responseText, 24, TimeUnit.HOURS);

        return new AIResponse(responseText, response.getUsage().getTotalTokens(), false);
    }

    private String selectModel(String message) {
        // ë‹¨ìˆœ ì§ˆë¬¸ì€ ì €ë¹„ìš© ëª¨ë¸
        if (message.length() < 50) {
            return "gpt-3.5-turbo";
        }
        return "gpt-4";
    }
}
```

#### 4.4.2 í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ JSON

```json
{
  "templates": {
    "customer_service": {
      "system": "ë‹¹ì‹ ì€ {{brand_name}}ì˜ ê³ ê° ì‘ëŒ€ AIì…ë‹ˆë‹¤.\n\n[ë¹„ì¦ˆë‹ˆìŠ¤ ì •ë³´]\n- ì—…ì¢…: {{industry}}\n- ì˜ì—…ì‹œê°„: {{business_hours}}\n- ì£¼ì†Œ: {{address}}\n- ì†Œê°œ: {{description}}\n\n[ì‘ë‹µ ê·œì¹™]\n1. {{tone}} í†¤ìœ¼ë¡œ ì‘ë‹µ\n2. 150ì ì´ë‚´\n3. ë¶ˆí™•ì‹¤í•œ ì •ë³´ëŠ” í™•ì¸ í›„ ì•ˆë‚´ ì•½ì†\n4. ê¸ˆì§€ì–´: {{banned_words}}",
      "variables": ["brand_name", "industry", "business_hours", "address", "description", "tone", "banned_words"]
    },
    "faq_generator": {
      "system": "ì†Œìƒê³µì¸ ë¹„ì¦ˆë‹ˆìŠ¤ FAQë¥¼ ìƒì„±í•©ë‹ˆë‹¤.",
      "user": "ë‹¤ìŒ ì •ë³´ë¡œ FAQ {{count}}ê°œ ìƒì„±:\n\nì—…ì¢…: {{industry}}\në¸Œëœë“œ: {{brand_name}}\nì„¤ëª…: {{description}}\n\ní˜•ì‹:\n{\"keyword\": \"í‚¤ì›Œë“œ\", \"response\": \"ì‘ë‹µ\"}",
      "variables": ["count", "industry", "brand_name", "description"]
    }
  }
}
```

### 4.5 ì˜ˆì•½ ì‹œìŠ¤í…œ êµ¬ì¡° (PHP MVC)

```php
// app/Http/Controllers/ReservationController.php

class ReservationController extends Controller
{
    // ì˜ˆì•½ í˜ì´ì§€ ì¡°íšŒ (ê³µê°œ)
    public function show(string $slug)
    {
        $user = User::where('reservation_slug', $slug)->firstOrFail();
        $form = $user->reservationForm;
        $availableSlots = $this->getAvailableSlots($form);

        return response()->json([
            'brand_name' => $user->brand_name,
            'title' => $form->title,
            'description' => $form->description,
            'fields' => $form->fields,
            'available_slots' => $availableSlots
        ]);
    }

    // ì˜ˆì•½ ìƒì„± (ê³µê°œ)
    public function store(Request $request, string $slug)
    {
        $user = User::where('reservation_slug', $slug)->firstOrFail();

        $validated = $request->validate([
            'customer_name' => 'required|string|max:100',
            'phone' => 'required|string|max:20',
            'email' => 'nullable|email',
            'service' => 'required|string',
            'date' => 'required|date|after:today',
            'time' => 'required|string',
            'requests' => 'nullable|string|max:500'
        ]);

        // ìŠ¬ë¡¯ ê°€ìš©ì„± ì¬í™•ì¸
        if (!$this->isSlotAvailable($user->id, $validated['date'], $validated['time'])) {
            return response()->json(['error' => 'ì„ íƒí•œ ì‹œê°„ì€ ì´ë¯¸ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.'], 422);
        }

        $reservation = Reservation::create([
            'user_id' => $user->id,
            'customer_name' => $validated['customer_name'],
            'phone' => $validated['phone'],
            'email' => $validated['email'],
            'service' => $validated['service'],
            'date' => $validated['date'],
            'time' => $validated['time'],
            'requests' => $validated['requests'],
            'status' => 'pending'
        ]);

        // ê´€ë¦¬ì ì•Œë¦¼ ë°œì†¡
        event(new ReservationCreated($reservation));

        return response()->json([
            'message' => 'ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',
            'reservation_id' => $reservation->id
        ], 201);
    }

    // ì˜ˆì•½ ëª©ë¡ (ê´€ë¦¬ì)
    public function index(Request $request)
    {
        $user = $request->user();

        $reservations = Reservation::where('user_id', $user->id)
            ->when($request->status, fn($q) => $q->where('status', $request->status))
            ->orderBy('date', 'asc')
            ->orderBy('time', 'asc')
            ->paginate(20);

        return response()->json($reservations);
    }

    // ì˜ˆì•½ ìƒíƒœ ë³€ê²½
    public function updateStatus(Request $request, int $id)
    {
        $reservation = Reservation::where('user_id', $request->user()->id)
            ->findOrFail($id);

        $validated = $request->validate([
            'status' => 'required|in:pending,confirmed,cancelled'
        ]);

        $reservation->update(['status' => $validated['status']]);

        // ê³ ê° ì•Œë¦¼ ë°œì†¡
        if ($validated['status'] === 'confirmed') {
            event(new ReservationConfirmed($reservation));
        }

        return response()->json($reservation);
    }
}
```

---

## 5. DB ì„¤ê³„ (ERD í…ìŠ¤íŠ¸ ì •ì˜)

### 5.1 users í…Œì´ë¸”

```sql
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    brand_name VARCHAR(100) NOT NULL,
    industry ENUM('cafe', 'shopping', 'beauty', 'freelance', 'restaurant', 'other') NOT NULL,
    business_hours VARCHAR(255) NULL,
    address VARCHAR(500) NULL,
    description TEXT NULL,
    contact_email VARCHAR(255) NULL,
    contact_phone VARCHAR(20) NULL,
    reservation_slug VARCHAR(50) UNIQUE,
    ai_enabled BOOLEAN DEFAULT TRUE,
    ai_tone ENUM('professional', 'friendly', 'formal', 'casual') DEFAULT 'friendly',
    banned_words TEXT NULL COMMENT 'JSON array of banned words',
    email_verified_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_email (email),
    INDEX idx_reservation_slug (reservation_slug)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5.2 channels í…Œì´ë¸”

```sql
CREATE TABLE channels (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    channel_type ENUM('instagram', 'kakao', 'naver') NOT NULL,
    account_id VARCHAR(255) NOT NULL COMMENT 'Platform account ID',
    account_name VARCHAR(255) NULL COMMENT 'Display name (@username)',
    access_token TEXT NOT NULL,
    refresh_token TEXT NULL,
    token_expires_at TIMESTAMP NULL,
    webhook_status ENUM('active', 'inactive', 'error') DEFAULT 'inactive',
    webhook_error_message VARCHAR(500) NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_channel (user_id, channel_type),
    INDEX idx_channel_type (channel_type),
    INDEX idx_account_id (account_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5.3 auto_rules í…Œì´ë¸”

```sql
CREATE TABLE auto_rules (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    name VARCHAR(100) NOT NULL,
    match_type ENUM('EXACT', 'CONTAINS', 'REGEX') NOT NULL DEFAULT 'CONTAINS',
    keyword VARCHAR(500) NOT NULL,
    response_text TEXT NOT NULL,
    include_reservation_link BOOLEAN DEFAULT FALSE,
    include_estimate_link BOOLEAN DEFAULT FALSE,
    priority INT UNSIGNED DEFAULT 100 COMMENT 'Lower = higher priority',
    channels JSON NOT NULL COMMENT '["instagram", "kakao", "naver"]',
    cooldown_minutes INT UNSIGNED DEFAULT 60,
    active_hours_start TIME NULL COMMENT 'NULL = always active',
    active_hours_end TIME NULL,
    active_days JSON NULL COMMENT '[0,1,2,3,4,5,6] = all days',
    is_active BOOLEAN DEFAULT TRUE,
    trigger_count BIGINT UNSIGNED DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_active (user_id, is_active),
    INDEX idx_priority (priority)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5.4 ai_templates í…Œì´ë¸”

```sql
CREATE TABLE ai_templates (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    name VARCHAR(100) NOT NULL,
    template_type ENUM('faq', 'greeting', 'closing', 'custom') NOT NULL,
    keyword VARCHAR(255) NULL,
    prompt_template TEXT NOT NULL,
    response_example TEXT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    usage_count BIGINT UNSIGNED DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_type (user_id, template_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5.5 message_logs í…Œì´ë¸”

```sql
CREATE TABLE message_logs (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    channel ENUM('instagram', 'kakao', 'naver') NOT NULL,
    sender_id VARCHAR(255) NOT NULL,
    sender_name VARCHAR(255) NULL,
    received_message TEXT NOT NULL,
    response_message TEXT NULL,
    response_type ENUM('rule', 'ai', 'manual', 'none') NOT NULL,
    matched_rule_id BIGINT UNSIGNED NULL,
    ai_tokens_used INT UNSIGNED DEFAULT 0,
    processing_time_ms INT UNSIGNED NULL,
    error_message VARCHAR(500) NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (matched_rule_id) REFERENCES auto_rules(id) ON DELETE SET NULL,
    INDEX idx_user_created (user_id, created_at),
    INDEX idx_channel (channel),
    INDEX idx_response_type (response_type),
    INDEX idx_sender (sender_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- íŒŒí‹°ì…”ë‹ (ëŒ€ìš©ëŸ‰ ì²˜ë¦¬ìš©)
-- ALTER TABLE message_logs PARTITION BY RANGE (UNIX_TIMESTAMP(created_at)) (...);
```

### 5.6 reservations í…Œì´ë¸”

```sql
CREATE TABLE reservations (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    customer_name VARCHAR(100) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    email VARCHAR(255) NULL,
    service VARCHAR(255) NOT NULL,
    date DATE NOT NULL,
    time TIME NOT NULL,
    requests TEXT NULL,
    status ENUM('pending', 'confirmed', 'cancelled', 'completed') DEFAULT 'pending',
    source ENUM('chat', 'web', 'manual') DEFAULT 'web',
    source_channel VARCHAR(50) NULL COMMENT 'instagram, kakao, etc.',
    notes TEXT NULL COMMENT 'Admin notes',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_date (user_id, date),
    INDEX idx_status (status),
    INDEX idx_phone (phone)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5.7 estimate_requests í…Œì´ë¸”

```sql
CREATE TABLE estimate_requests (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    customer_name VARCHAR(100) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    email VARCHAR(255) NULL,
    service_type VARCHAR(255) NOT NULL,
    details TEXT NOT NULL,
    budget VARCHAR(100) NULL,
    preferred_date DATE NULL,
    attachments JSON NULL COMMENT 'Array of file URLs',
    status ENUM('pending', 'quoted', 'accepted', 'rejected', 'completed') DEFAULT 'pending',
    quoted_amount DECIMAL(12,2) NULL,
    quote_message TEXT NULL,
    source ENUM('chat', 'web', 'manual') DEFAULT 'web',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_status (user_id, status),
    INDEX idx_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5.8 subscriptions í…Œì´ë¸”

```sql
CREATE TABLE subscriptions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    plan ENUM('free', 'pro', 'agency') NOT NULL DEFAULT 'free',
    status ENUM('active', 'cancelled', 'expired', 'past_due') DEFAULT 'active',
    price_monthly DECIMAL(10,2) NOT NULL DEFAULT 0,
    daily_message_limit INT NULL COMMENT 'NULL = unlimited',
    features JSON NOT NULL COMMENT 'Feature flags',
    payment_provider VARCHAR(50) NULL COMMENT 'stripe, paddle, etc.',
    payment_subscription_id VARCHAR(255) NULL,
    current_period_start TIMESTAMP NULL,
    current_period_end TIMESTAMP NULL,
    cancelled_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user (user_id),
    INDEX idx_status (status),
    INDEX idx_period_end (current_period_end)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5.9 webhook_events í…Œì´ë¸”

```sql
CREATE TABLE webhook_events (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    channel ENUM('instagram', 'kakao', 'naver') NOT NULL,
    event_type VARCHAR(50) NOT NULL COMMENT 'message, comment, mention, verification',
    raw_payload JSON NOT NULL,
    signature VARCHAR(255) NULL,
    signature_valid BOOLEAN NULL,
    processed BOOLEAN DEFAULT FALSE,
    process_attempts INT UNSIGNED DEFAULT 0,
    error_message TEXT NULL,
    processed_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_channel_processed (channel, processed),
    INDEX idx_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 30ì¼ ì´í›„ ìë™ ì‚­ì œ ì´ë²¤íŠ¸
-- CREATE EVENT cleanup_webhook_events
-- ON SCHEDULE EVERY 1 DAY
-- DO DELETE FROM webhook_events WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);
```

### 5.10 ERD ê´€ê³„ë„

```
users (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€< channels (N)
  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€< auto_rules (N)
  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€< ai_templates (N)
  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€< message_logs (N)
  â”‚                         â”‚
  â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€> auto_rules (matched_rule_id)
  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€< reservations (N)
  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€< estimate_requests (N)
  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€< subscriptions (1)

webhook_events (standalone - ì„ì‹œ ì €ì¥ìš©)
```

---

## 6. API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡ (Request/Response)

### 6.1 Instagram Webhook

#### GET /api/webhook/instagram (ê²€ì¦)

```http
GET /api/webhook/instagram?hub.mode=subscribe&hub.challenge=1234567890&hub.verify_token=my_verify_token
```

**Response (200 OK)**
```
1234567890
```

#### POST /api/webhook/instagram (ìˆ˜ì‹ )

**Request Headers**
```
Content-Type: application/json
X-Hub-Signature-256: sha256=abc123...
```

**Request Body**
```json
{
  "object": "instagram",
  "entry": [
    {
      "id": "17841400000000000",
      "time": 1701234567,
      "messaging": [
        {
          "sender": {"id": "7654321098765432"},
          "recipient": {"id": "17841400000000000"},
          "timestamp": 1701234567000,
          "message": {
            "mid": "m_AbCdEf123456",
            "text": "ì˜ì—…ì‹œê°„ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?"
          }
        }
      ]
    }
  ]
}
```

**Response (200 OK)**
```json
{
  "status": "received"
}
```

**Validation Logic**
```php
// 1. Signature ê²€ì¦
$signature = $request->header('X-Hub-Signature-256');
$payload = $request->getContent();
$expectedSignature = 'sha256=' . hash_hmac('sha256', $payload, config('services.instagram.app_secret'));

if (!hash_equals($expectedSignature, $signature)) {
    return response()->json(['error' => 'Invalid signature'], 403);
}

// 2. Object íƒ€ì… ê²€ì¦
if ($request->input('object') !== 'instagram') {
    return response()->json(['error' => 'Invalid object type'], 400);
}
```

---

### 6.2 ìë™ì‘ë‹µ í…ŒìŠ¤íŠ¸ API

#### POST /api/ai/test-message

**Request Headers**
```
Authorization: Bearer {access_token}
Content-Type: application/json
```

**Request Body**
```json
{
  "message": "ê°€ê²©ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?",
  "channel": "instagram"
}
```

**Response (200 OK)**
```json
{
  "matched_rule": {
    "id": 2,
    "name": "ê°€ê²© ë¬¸ì˜",
    "match_type": "CONTAINS",
    "keyword": "ê°€ê²©"
  },
  "response_type": "rule",
  "response_text": "ê°€ê²©í‘œë¥¼ ë³´ë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.\n\nğŸ“… ì˜ˆì•½í•˜ê¸°: https://autoreply.app/mybrand",
  "would_trigger_cooldown": true
}
```

**Response (AI ì‘ë‹µì¼ ê²½ìš°)**
```json
{
  "matched_rule": null,
  "response_type": "ai",
  "response_text": "ì•ˆë…•í•˜ì„¸ìš”! ê°€ê²©ì€ ì„œë¹„ìŠ¤ ì¢…ë¥˜ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. ìì„¸í•œ ê°€ê²©í‘œëŠ” ë§í¬ë¥¼ í†µí•´ í™•ì¸í•´ì£¼ì„¸ìš” :)",
  "ai_tokens_used": 45,
  "cached": false
}
```

---

### 6.3 ì‘ë‹µ ì „ì†¡ API

#### POST /api/channel/send-message

**Request Headers**
```
Authorization: Bearer {access_token}
Content-Type: application/json
```

**Request Body**
```json
{
  "channel": "instagram",
  "recipient_id": "7654321098765432",
  "message": "ì•ˆë…•í•˜ì„¸ìš”! ì˜ì—…ì‹œê°„ì€ í‰ì¼ 10:00-22:00ì…ë‹ˆë‹¤."
}
```

**Response (200 OK)**
```json
{
  "success": true,
  "message_id": "m_AbCdEf789012",
  "sent_at": "2024-11-27T14:30:00Z"
}
```

**Response (429 Rate Limit)**
```json
{
  "success": false,
  "error": "rate_limit_exceeded",
  "message": "Instagram API rate limit exceeded",
  "retry_after": 60
}
```

---

### 6.4 ì˜ˆì•½/ê²¬ì  í˜ì´ì§€ API

#### POST /api/reservation/create (ê³µê°œ API)

**Request Body**
```json
{
  "slug": "mybrand",
  "customer_name": "ê¹€ì² ìˆ˜",
  "phone": "010-1234-5678",
  "email": "kim@example.com",
  "service": "í—¤ì–´ì»· + íŒ",
  "date": "2024-12-01",
  "time": "14:00",
  "requests": "ì§§ê²Œ ìë¥´ê³  ìì—°ìŠ¤ëŸ¬ìš´ íŒìœ¼ë¡œ ë¶€íƒë“œë¦½ë‹ˆë‹¤."
}
```

**Response (201 Created)**
```json
{
  "success": true,
  "message": "ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
  "reservation": {
    "id": 123,
    "customer_name": "ê¹€ì² ìˆ˜",
    "service": "í—¤ì–´ì»· + íŒ",
    "date": "2024-12-01",
    "time": "14:00",
    "status": "pending"
  }
}
```

**Response (422 Validation Error)**
```json
{
  "success": false,
  "error": "validation_error",
  "message": "ì„ íƒí•œ ì‹œê°„ì€ ì´ë¯¸ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "errors": {
    "time": ["ì´ ì‹œê°„ëŒ€ëŠ” ì´ë¯¸ ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."]
  }
}
```

#### GET /api/reservations (ì¸ì¦ í•„ìš”)

**Request Headers**
```
Authorization: Bearer {access_token}
```

**Query Parameters**
```
?status=pending&page=1&per_page=20
```

**Response (200 OK)**
```json
{
  "data": [
    {
      "id": 1,
      "customer_name": "ê¹€ì² ìˆ˜",
      "phone": "010-1234-5678",
      "email": "kim@example.com",
      "service": "í—¤ì–´ì»· + íŒ",
      "date": "2024-12-01",
      "time": "14:00",
      "requests": "ì§§ê²Œ ìë¥´ê³  ìì—°ìŠ¤ëŸ¬ìš´ íŒìœ¼ë¡œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
      "status": "pending",
      "created_at": "2024-11-27T10:00:00Z"
    }
  ],
  "meta": {
    "current_page": 1,
    "last_page": 5,
    "per_page": 20,
    "total": 95
  }
}
```

---

### 6.5 ê¸°íƒ€ ì£¼ìš” API

#### POST /api/auth/login

**Request Body**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Response (200 OK)**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "token_type": "Bearer",
  "expires_in": 3600,
  "refresh_token": "def50200..."
}
```

#### GET /api/dashboard/stats

**Response (200 OK)**
```json
{
  "today": {
    "total_messages": 45,
    "rule_responses": 32,
    "ai_responses": 13,
    "avg_response_time_ms": 234
  },
  "monthly": {
    "total_messages": 1234,
    "rule_responses": 856,
    "ai_responses": 378,
    "ai_tokens_used": 45000,
    "ai_cost_estimate": 0.90
  },
  "by_channel": [
    {"channel": "instagram", "message_count": 800, "response_rate": 98.5},
    {"channel": "kakao", "message_count": 300, "response_rate": 97.2},
    {"channel": "naver", "message_count": 134, "response_rate": 99.1}
  ],
  "top_rules": [
    {"rule_id": 1, "rule_name": "ì˜ì—…ì‹œê°„ ì•ˆë‚´", "trigger_count": 234},
    {"rule_id": 2, "rule_name": "ê°€ê²© ë¬¸ì˜", "trigger_count": 189}
  ],
  "daily_trend": [
    {"date": "2024-11-21", "message_count": 38},
    {"date": "2024-11-22", "message_count": 42}
  ]
}
```

#### POST /api/rules

**Request Body**
```json
{
  "name": "ì˜ì—…ì‹œê°„ ì•ˆë‚´",
  "match_type": "CONTAINS",
  "keyword": "ì˜ì—…ì‹œê°„",
  "response_text": "ì˜ì—…ì‹œê°„ì€ í‰ì¼ 10:00-22:00, ì£¼ë§ 11:00-23:00ì…ë‹ˆë‹¤.",
  "include_reservation_link": true,
  "priority": 1,
  "channels": ["instagram", "kakao"],
  "cooldown_minutes": 60,
  "is_active": true
}
```

**Response (201 Created)**
```json
{
  "id": 5,
  "name": "ì˜ì—…ì‹œê°„ ì•ˆë‚´",
  "match_type": "CONTAINS",
  "keyword": "ì˜ì—…ì‹œê°„",
  "response_text": "ì˜ì—…ì‹œê°„ì€ í‰ì¼ 10:00-22:00, ì£¼ë§ 11:00-23:00ì…ë‹ˆë‹¤.",
  "include_reservation_link": true,
  "priority": 1,
  "channels": ["instagram", "kakao"],
  "cooldown_minutes": 60,
  "is_active": true,
  "trigger_count": 0,
  "created_at": "2024-11-27T14:30:00Z"
}
```

---

## 7. 2ì£¼ ê°œë°œ ë¡œë“œë§µ (1ì¸ ê¸°ì¤€)

### 1ì£¼ì°¨: í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„ (Instagram â†’ ê·œì¹™ì—”ì§„ â†’ ì‘ë‹µ)

| Day | ëª©í‘œ | ìƒì„¸ ì‘ì—… |
|-----|------|----------|
| **Day 1** | í™˜ê²½ ì„¸íŒ… | - ì„œë²„ í™˜ê²½ êµ¬ì„± (PHP 8.2, Java 17, MySQL 8)<br>- Laravel í”„ë¡œì íŠ¸ ìƒì„±<br>- Spring Boot í”„ë¡œì íŠ¸ ìƒì„±<br>- DB ìŠ¤í‚¤ë§ˆ ìƒì„± (users, channels, auto_rules, message_logs)<br>- Redis ì„¤ì¹˜ ë° ì—°ê²° í…ŒìŠ¤íŠ¸ |
| **Day 2** | ì¸ì¦ ì‹œìŠ¤í…œ | - íšŒì›ê°€ì…/ë¡œê·¸ì¸ API êµ¬í˜„<br>- JWT í† í° ë°œê¸‰/ê²€ì¦<br>- í”„ë¡ íŠ¸ì—”ë“œ ë¡œê·¸ì¸ ì—°ë™<br>- ì„¸ì…˜ ë¯¸ë“¤ì›¨ì–´ êµ¬í˜„ |
| **Day 3** | Instagram ì›¹í›… | - Meta ê°œë°œì ì•± ë“±ë¡<br>- ì›¹í›… ê²€ì¦ ì—”ë“œí¬ì¸íŠ¸ (GET)<br>- ì›¹í›… ìˆ˜ì‹  ì—”ë“œí¬ì¸íŠ¸ (POST)<br>- ì„œëª… ê²€ì¦ ë¡œì§<br>- webhook_events í…Œì´ë¸” ì €ì¥ |
| **Day 4** | ë©”ì‹œì§€ í êµ¬í˜„ | - Redis Stream ë˜ëŠ” RabbitMQ ì„¤ì •<br>- PHPì—ì„œ ë©”ì‹œì§€ í‘¸ì‹œ ë¡œì§<br>- Java Worker ê¸°ë³¸ êµ¬ì¡°<br>- ë©”ì‹œì§€ ì†Œë¹„ í…ŒìŠ¤íŠ¸ |
| **Day 5** | ê·œì¹™ì—”ì§„ êµ¬í˜„ | - auto_rules CRUD API<br>- RuleEngine í´ë˜ìŠ¤ (Java)<br>- ë§¤ì¹­ ë¡œì§ (EXACT, CONTAINS, REGEX)<br>- ìš°ì„ ìˆœìœ„ ì²˜ë¦¬<br>- í”„ë¡ íŠ¸ì—”ë“œ ê·œì¹™ ê´€ë¦¬ UI ì—°ë™ |
| **Day 6** | ì‘ë‹µ ì „ì†¡ êµ¬í˜„ | - Instagram Send Message API ì—°ë™<br>- ì±„ë„ë³„ ì‘ë‹µ ì „ì†¡ ì„œë¹„ìŠ¤<br>- ì¿¨ë‹¤ìš´ ì²˜ë¦¬ (Redis)<br>- ì—ëŸ¬ í•¸ë“¤ë§ ë° ì¬ì‹œë„ ë¡œì§ |
| **Day 7** | E2E í…ŒìŠ¤íŠ¸ & ë””ë²„ê¹… | - ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸<br>- ë¡œê·¸ ì €ì¥ í™•ì¸<br>- ì‘ë‹µ ì‹œê°„ ìµœì í™”<br>- ë²„ê·¸ ìˆ˜ì • |

### 2ì£¼ì°¨: í™•ì¥ ê¸°ëŠ¥ ë° ëŸ°ì¹­ ì¤€ë¹„

| Day | ëª©í‘œ | ìƒì„¸ ì‘ì—… |
|-----|------|----------|
| **Day 8** | AI ì‘ë‹µ êµ¬í˜„ | - OpenAI API ì—°ë™<br>- í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ êµ¬í˜„<br>- AI í´ë°± ë¡œì§<br>- ì‘ë‹µ ìºì‹± (Redis)<br>- ê¸ˆì§€ì–´ í•„í„°ë§ |
| **Day 9** | ì˜ˆì•½ ì‹œìŠ¤í…œ | - ì˜ˆì•½í¼ ìŠ¤í‚¤ë§ˆ êµ¬í˜„<br>- ê³µê°œ ì˜ˆì•½ í˜ì´ì§€ API<br>- ì˜ˆì•½ ìƒì„±/ëª©ë¡/ìƒíƒœ ë³€ê²½<br>- í”„ë¡ íŠ¸ì—”ë“œ ì˜ˆì•½ê´€ë¦¬ ì—°ë™ |
| **Day 10** | ëŒ€ì‹œë³´ë“œ êµ¬í˜„ | - í†µê³„ ì§‘ê³„ ì¿¼ë¦¬<br>- ëŒ€ì‹œë³´ë“œ API<br>- ë©”ì‹œì§€ ë¡œê·¸ API<br>- í”„ë¡ íŠ¸ì—”ë“œ ëŒ€ì‹œë³´ë“œ ì—°ë™ |
| **Day 11** | í”„ë¡œí•„/ì„¤ì • | - í”„ë¡œí•„ CRUD API<br>- ë¹„ì¦ˆë‹ˆìŠ¤ ì •ë³´ ì €ì¥<br>- AI ì„¤ì • (í†¤, ê¸ˆì§€ì–´)<br>- ì˜ˆì•½ ìŠ¬ëŸ¬ê·¸ ì„¤ì • |
| **Day 12** | ìš”ê¸ˆì œ êµ¬í˜„ | - subscriptions í…Œì´ë¸” í™œìš©<br>- ì¼ì¼ í• ë‹¹ëŸ‰ ì²´í¬ ë¡œì§<br>- í”Œëœë³„ ê¸°ëŠ¥ ì œí•œ<br>- ì—…ê·¸ë ˆì´ë“œ í˜ì´ì§€ (ê²°ì œ ì—°ë™ì€ ì¶”í›„) |
| **Day 13** | í…ŒìŠ¤íŠ¸ & ë³´ì•ˆ | - ì „ì²´ API í…ŒìŠ¤íŠ¸<br>- Rate Limiting ì ìš©<br>- ì…ë ¥ê°’ ê²€ì¦ ê°•í™”<br>- XSS/SQL Injection ë°©ì§€ í™•ì¸<br>- ë¡œê·¸ ì •ë¦¬ |
| **Day 14** | ë°°í¬ & ëŸ°ì¹­ | - í”„ë¡œë•ì…˜ ì„œë²„ ì„¸íŒ…<br>- SSL ì¸ì¦ì„œ ì„¤ì •<br>- ë„ë©”ì¸ ì—°ê²°<br>- ëª¨ë‹ˆí„°ë§ ì„¤ì •<br>- ì‹¤ì‚¬ìš© í…ŒìŠ¤íŠ¸<br>- ë¬¸ì„œ ì •ë¦¬ |

---

## 8. QA ì²´í¬ë¦¬ìŠ¤íŠ¸

### 8.1 ì±„ë„ ì—°ë™ í…ŒìŠ¤íŠ¸

| í•­ëª© | í…ŒìŠ¤íŠ¸ ë‚´ìš© | ì˜ˆìƒ ê²°ê³¼ | í†µê³¼ |
|------|------------|----------|------|
| ì¸ìŠ¤íƒ€ ì—°ë™ | OAuth í”Œë¡œìš° ì™„ë£Œ | í† í° ì €ì¥, ì—°ë™ ìƒíƒœ í‘œì‹œ | â˜ |
| ì›¹í›… ê²€ì¦ | GET ìš”ì²­ ì‹œ challenge ë°˜í™˜ | 200 OK + challenge ê°’ | â˜ |
| í† í° ë§Œë£Œì¼ | 60ì¼ ì´ë‚´ í† í° ê°±ì‹  | ìë™ ê°±ì‹  ë˜ëŠ” ì•Œë¦¼ | â˜ |
| ì—°ë™ í•´ì œ | ì—°ë™ í•´ì œ ë²„íŠ¼ í´ë¦­ | í† í° ì‚­ì œ, ìƒíƒœ ë³€ê²½ | â˜ |

### 8.2 ê·œì¹™ì—”ì§„ ì‘ë‹µ ì •í™•ë„

| í•­ëª© | í…ŒìŠ¤íŠ¸ ë‚´ìš© | ì˜ˆìƒ ê²°ê³¼ | í†µê³¼ |
|------|------------|----------|------|
| EXACT ë§¤ì¹­ | "ê°€ê²©" ì…ë ¥ (ê·œì¹™: "ê°€ê²©") | ë§¤ì¹­ ì„±ê³µ | â˜ |
| EXACT ë¶ˆì¼ì¹˜ | "ê°€ê²©í‘œ" ì…ë ¥ (ê·œì¹™: "ê°€ê²©") | ë§¤ì¹­ ì‹¤íŒ¨ | â˜ |
| CONTAINS ë§¤ì¹­ | "ê°€ê²©ì´ ì–¼ë§ˆì˜ˆìš”?" ì…ë ¥ | ë§¤ì¹­ ì„±ê³µ | â˜ |
| REGEX ë§¤ì¹­ | "ì˜ˆì•½.*í•˜ê³ ì‹¶ì–´ìš”" íŒ¨í„´ | ë§¤ì¹­ ì„±ê³µ | â˜ |
| ìš°ì„ ìˆœìœ„ | ë™ì¼ í‚¤ì›Œë“œ, ë‹¤ë¥¸ ìš°ì„ ìˆœìœ„ | ë†’ì€ ìš°ì„ ìˆœìœ„ ê·œì¹™ ì ìš© | â˜ |
| ë§í¬ ì‚½ì… | include_reservation_link = true | URL í¬í•¨ëœ ì‘ë‹µ | â˜ |

### 8.3 AI ì‘ë‹µ ì˜¤ë¥˜ ì²˜ë¦¬

| í•­ëª© | í…ŒìŠ¤íŠ¸ ë‚´ìš© | ì˜ˆìƒ ê²°ê³¼ | í†µê³¼ |
|------|------------|----------|------|
| AI ì •ìƒ ì‘ë‹µ | ê·œì¹™ ë¯¸ë§¤ì¹­ ë©”ì‹œì§€ | AI ì‘ë‹µ ìƒì„± | â˜ |
| AI ë¹„í™œì„± | ai_enabled = false | ê¸°ë³¸ í´ë°± ë©”ì‹œì§€ | â˜ |
| API íƒ€ì„ì•„ì›ƒ | OpenAI ì§€ì—° | í´ë°± ë©”ì‹œì§€ ë°˜í™˜ | â˜ |
| API ì—ëŸ¬ | 401/500 ì—ëŸ¬ | ì—ëŸ¬ ë¡œê·¸ + í´ë°± | â˜ |
| ê¸ˆì§€ì–´ í•„í„° | ê¸ˆì§€ì–´ í¬í•¨ ì‘ë‹µ | *** ì¹˜í™˜ | â˜ |
| ìºì‹œ íˆíŠ¸ | ë™ì¼ ì§ˆë¬¸ 2íšŒ | 2íšŒì°¨ ìºì‹œ ì‘ë‹µ | â˜ |

### 8.4 ì¤‘ë³µ ì‘ë‹µ ë°©ì§€

| í•­ëª© | í…ŒìŠ¤íŠ¸ ë‚´ìš© | ì˜ˆìƒ ê²°ê³¼ | í†µê³¼ |
|------|------------|----------|------|
| ì¿¨ë‹¤ìš´ ì‘ë™ | 60ë¶„ ë‚´ ë™ì¼ ê·œì¹™ íŠ¸ë¦¬ê±° | 2íšŒì°¨ ì‘ë‹µ ì•ˆ í•¨ | â˜ |
| ì¿¨ë‹¤ìš´ í•´ì œ | 60ë¶„ í›„ ë™ì¼ ê·œì¹™ íŠ¸ë¦¬ê±° | ì‘ë‹µ ì •ìƒ ë°œì†¡ | â˜ |
| ë‹¤ë¥¸ ê·œì¹™ | ì¿¨ë‹¤ìš´ ì¤‘ ë‹¤ë¥¸ ê·œì¹™ íŠ¸ë¦¬ê±° | ì •ìƒ ì‘ë‹µ | â˜ |
| ë‹¤ë¥¸ ì‚¬ìš©ì | ë™ì¼ ê·œì¹™, ë‹¤ë¥¸ sender | ê°ê° ì‘ë‹µ | â˜ |

### 8.5 ì˜ˆì•½ í¼ ì œì¶œ í…ŒìŠ¤íŠ¸

| í•­ëª© | í…ŒìŠ¤íŠ¸ ë‚´ìš© | ì˜ˆìƒ ê²°ê³¼ | í†µê³¼ |
|------|------------|----------|------|
| ì •ìƒ ì œì¶œ | í•„ìˆ˜ í•„ë“œ ëª¨ë‘ ì…ë ¥ | 201 Created | â˜ |
| í•„ìˆ˜ê°’ ëˆ„ë½ | customer_name ëˆ„ë½ | 422 Validation Error | â˜ |
| ì¤‘ë³µ ì˜ˆì•½ | ë™ì¼ ì‹œê°„ëŒ€ ì¬ì˜ˆì•½ | 422 ì‹œê°„ ë¶ˆê°€ ë©”ì‹œì§€ | â˜ |
| ê³¼ê±° ë‚ ì§œ | ì–´ì œ ë‚ ì§œ ì„ íƒ | 422 Validation Error | â˜ |
| ì•Œë¦¼ ë°œì†¡ | ì˜ˆì•½ ìƒì„± ì‹œ | ì´ë©”ì¼/SMS ë°œì†¡ í™•ì¸ | â˜ |

### 8.6 ì†ë„/ì§€ì—° í…ŒìŠ¤íŠ¸

| í•­ëª© | í…ŒìŠ¤íŠ¸ ë‚´ìš© | ê¸°ì¤€ | í†µê³¼ |
|------|------------|------|------|
| ì›¹í›… ì‘ë‹µ | Instagram ì›¹í›… ìˆ˜ì‹  â†’ 200 ë°˜í™˜ | < 3ì´ˆ | â˜ |
| ê·œì¹™ ì‘ë‹µ | ë©”ì‹œì§€ ìˆ˜ì‹  â†’ ì‘ë‹µ ì „ì†¡ | < 5ì´ˆ | â˜ |
| AI ì‘ë‹µ | AI ìƒì„± í¬í•¨ | < 10ì´ˆ | â˜ |
| ëŒ€ì‹œë³´ë“œ ë¡œë”© | í†µê³„ API ì‘ë‹µ | < 2ì´ˆ | â˜ |
| ë™ì‹œ ì²˜ë¦¬ | 10ê±´ ë™ì‹œ ë©”ì‹œì§€ | ì „ì²´ < 30ì´ˆ | â˜ |

### 8.7 ëª¨ë°”ì¼ UI ì ê²€

| í•­ëª© | í…ŒìŠ¤íŠ¸ ë‚´ìš© | ì˜ˆìƒ ê²°ê³¼ | í†µê³¼ |
|------|------------|----------|------|
| ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ | 375px ë„ˆë¹„ | ë ˆì´ì•„ì›ƒ ì •ìƒ | â˜ |
| ì‚¬ì´ë“œë°” | ëª¨ë°”ì¼ì—ì„œ í–„ë²„ê±° ë©”ë‰´ | í† ê¸€ ë™ì‘ | â˜ |
| í…Œì´ë¸” ìŠ¤í¬ë¡¤ | ë¡œê·¸ í…Œì´ë¸” ê°€ë¡œ ìŠ¤í¬ë¡¤ | ìŠ¤í¬ë¡¤ ê°€ëŠ¥ | â˜ |
| ë²„íŠ¼ í„°ì¹˜ | ë²„íŠ¼ ìµœì†Œ 44px | í„°ì¹˜ ìš©ì´ | â˜ |
| í¼ ì…ë ¥ | ëª¨ë°”ì¼ í‚¤ë³´ë“œ | ì •ìƒ ì…ë ¥ | â˜ |

---

## 9. ëŸ°ì¹­ ì „ëµ & ë§ˆì¼€íŒ… í”Œëœ

### 9.1 14ì¼ ë¬´ë£Œì²´í—˜

```
[ë¬´ë£Œì²´í—˜ ì •ì±…]
- ê¸°ê°„: íšŒì›ê°€ì… í›„ 14ì¼
- ê¸°ëŠ¥: Pro í”Œëœ ì „ì²´ ê¸°ëŠ¥
- ì œí•œ: ì—†ìŒ (ë¬´ì œí•œ ìë™ì‘ë‹µ)
- ë§Œë£Œ í›„: Free í”Œëœ ìë™ ì „í™˜

[êµ¬í˜„]
- íšŒì›ê°€ì… ì‹œ subscription ìƒì„± (plan: 'pro', trial_ends_at: +14days)
- ë¡œê·¸ì¸ ì‹œ trial ë‚¨ì€ ì¼ìˆ˜ í‘œì‹œ
- ë§Œë£Œ 3ì¼ ì „ ì´ë©”ì¼ ì•Œë¦¼
- ë§Œë£Œ ì‹œ ìë™ ë‹¤ìš´ê·¸ë ˆì´ë“œ
```

### 9.2 ì¸ìŠ¤íƒ€ ì…€ëŸ¬ ì¹´í˜Â·ì˜¤í”ˆí†¡ ê³µëµ

**íƒ€ê²Ÿ ì»¤ë®¤ë‹ˆí‹°**
| í”Œë«í¼ | ì»¤ë®¤ë‹ˆí‹°ëª… | íšŒì›ìˆ˜ | ì ‘ê·¼ ë°©ì‹ |
|--------|-----------|--------|----------|
| ë„¤ì´ë²„ ì¹´í˜ | ì¸ìŠ¤íƒ€ë§ˆì¼“ ì…€ëŸ¬ëª¨ì„ | 15ë§Œ+ | í›„ê¸° ê²Œì‹œê¸€ |
| ì¹´ì¹´ì˜¤ ì˜¤í”ˆí†¡ | ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì…€ëŸ¬ë°© | 5ì²œ+ | ì •ë³´ ê³µìœ  |
| ë„¤ì´ë²„ ì¹´í˜ | 1ì¸ê¸°ì—… CEOëª¨ì„ | 10ë§Œ+ | ë„êµ¬ ì†Œê°œê¸€ |
| í˜ì´ìŠ¤ë¶ | ì†Œìƒê³µì¸ ë§ˆì¼€íŒ… ê·¸ë£¹ | 3ë§Œ+ | ê²½í—˜ ê³µìœ  |

**ê²Œì‹œë¬¼ í…œí”Œë¦¿**
```
[ì œëª©] ì¸ìŠ¤íƒ€ DM ìë™ì‘ë‹µìœ¼ë¡œ í•˜ë£¨ 2ì‹œê°„ ì•„ê¼ˆì–´ìš” (ë¬´ë£Œ íˆ´ ê³µìœ )

ì•ˆë…•í•˜ì„¸ìš”, OOO ìš´ì˜ ì¤‘ì¸ ì…€ëŸ¬ì…ë‹ˆë‹¤.

í•˜ë£¨ì— "ê°€ê²© ì–¼ë§ˆì˜ˆìš”?", "ì˜ì—…ì‹œê°„ ì•Œë ¤ì£¼ì„¸ìš”" ê°™ì€
ë˜‘ê°™ì€ DM 50ê°œì”© ë°›ëŠ”ë°... ì¼ì¼ì´ ë‹µì¥í•˜ëŠë¼ ì •ì‹  ì—†ì—ˆê±°ë“ ìš”.

ê·¼ë° ìµœê·¼ì— AutoReplyXë¼ëŠ” ìë™ì‘ë‹µ íˆ´ ì¨ë³´ë‹ˆê¹Œ ì§„ì§œ í¸í•´ìš”.
- í‚¤ì›Œë“œ ë„£ì–´ë‘ë©´ ì•Œì•„ì„œ ë‹µì¥
- AIê°€ ì•Œì•„ì„œ ëŒ€ë‹µë„ í•´ì¤Œ
- ì˜ˆì•½ ë§í¬ë„ ìë™ìœ¼ë¡œ ë³´ë‚´ì¤Œ

14ì¼ ë¬´ë£Œë¼ì„œ ì¼ë‹¨ ì¨ë´¤ëŠ”ë°, ê·¸ëƒ¥ ê³„ì† ì“°ê³  ìˆì–´ìš” ã…ã…
ì›” 9900ì›ì¸ë° ì‹œê°„ ìƒê°í•˜ë©´ ì™„ì „ ë‚¨ëŠ” ì¥ì‚¬...

í˜¹ì‹œ DM ì‘ëŒ€ ë•Œë¬¸ì— ê³ ë¯¼ì´ì‹  ë¶„ë“¤ í•œë²ˆ ì¨ë³´ì„¸ìš”!
(ê´‘ê³  ì•„ë‹ˆê³  ì§„ì§œ ì¢‹ì•„ì„œ ê³µìœ í•©ë‹ˆë‹¤)

[ë§í¬]
```

### 9.3 ë„¤ì´ë²„ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œë¬¼ ì„¸íŠ¸

**ê²Œì‹œë¬¼ 1: ë¬¸ì œ ì œê¸°**
```
[ì œëª©] ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ + ì¸ìŠ¤íƒ€ ìš´ì˜í•˜ì‹œëŠ” ë¶„ë“¤, í†¡í†¡ ì‘ëŒ€ ì–´ë–»ê²Œ í•˜ì„¸ìš”?

ì € í˜¼ì ìš´ì˜í•˜ëŠ”ë° í†¡í†¡ì´ë‘ ì¸ìŠ¤íƒ€ DM ë‘˜ ë‹¤ ì‹ ê²½ ì“°ë ¤ë‹ˆê¹Œ
ì§„ì§œ ì •ì‹ ì—†ë„¤ìš”...

íŠ¹íˆ ë°¤ì— ì˜¤ëŠ” ë¬¸ì˜ëŠ” ë‹¤ìŒë‚  ë‹µì¥í•˜ë©´ ì´ë¯¸ ë‹¤ë¥¸ ë°ì„œ ìƒ€ë‹¤ê³  í•˜ê³  ã… ã… 
ìë™ì‘ë‹µ ì“°ì‹œëŠ” ë¶„ ìˆìœ¼ì‹ ê°€ìš”?
```

**ê²Œì‹œë¬¼ 2: í•´ê²°ì±… ê³µìœ **
```
[ì œëª©] í†¡í†¡+ì¸ìŠ¤íƒ€ ìë™ì‘ë‹µ ì„¸íŒ… í›„ê¸° (feat. AutoReplyX)

ì§€ë‚œì£¼ì— ë¬¼ì–´ë´¤ë˜ ì‚¬ëŒì¸ë°ìš”,
ì´ê²ƒì €ê²ƒ ì°¾ì•„ë³´ë‹¤ê°€ AutoReplyX ì¨ë´¤ìŠµë‹ˆë‹¤.

[ì„¸íŒ… ê³¼ì •]
1. íšŒì›ê°€ì… (1ë¶„)
2. ì¸ìŠ¤íƒ€ ì—°ë™ (2ë¶„)
3. í‚¤ì›Œë“œ ê·œì¹™ 5ê°œ ë§Œë“¤ê¸° (10ë¶„)

ë!

[1ì£¼ì¼ ì‚¬ìš© í›„]
- ìë™ ì‘ë‹µëœ ë©”ì‹œì§€: 156ê±´
- ì§ì ‘ ì‘ëŒ€: 12ê±´ (ë³µì¡í•œ ë¬¸ì˜ë§Œ)
- ì˜ˆì•½ ë§í¬ í†µí•´ ì˜ˆì•½: 8ê±´

ì†”ì§íˆ ì›” 9900ì› ì•„ê¹Œìš¸ ì¤„ ì•Œì•˜ëŠ”ë°,
ì‹œê¸‰ìœ¼ë¡œ ì¹˜ë©´ ëª‡ ë§Œì› ì•„ë‚€ ì…ˆì´ì—ìš”.

14ì¼ ë¬´ë£Œë‹ˆê¹Œ ì¼ë‹¨ ì¨ë³´ì„¸ìš”!
```

### 9.4 ìë™ì‘ë‹µ ì„¸íŒ… ëŒ€í–‰ ì—…ì…€ë§ íŒ¨í‚¤ì§€

```
[ì„œë¹„ìŠ¤ êµ¬ì„±]
íŒ¨í‚¤ì§€ëª…: AutoReplyX ì„¸íŒ… ëŒ€í–‰ ì„œë¹„ìŠ¤
ê°€ê²©: 50,000ì› (1íšŒì„±)

í¬í•¨ ë‚´ìš©:
1. ì±„ë„ ì—°ë™ ëŒ€í–‰ (ì¸ìŠ¤íƒ€/ì¹´ì¹´ì˜¤/ë„¤ì´ë²„)
2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¶„ì„ â†’ ë§ì¶¤ FAQ 10ê°œ ì‘ì„±
3. ìë™ì‘ë‹µ ê·œì¹™ 10ê°œ ì„¸íŒ…
4. ì˜ˆì•½/ê²¬ì  í˜ì´ì§€ ì„¸íŒ…
5. 30ë¶„ ì‚¬ìš©ë²• êµìœ¡ (Zoom)
6. 2ì£¼ê°„ ì¹´í†¡ Q&A ì§€ì›

[íƒ€ê²Ÿ]
- IT ì„¸íŒ…ì— ì–´ë ¤ì›€ì„ ëŠë¼ëŠ” ì¤‘ì¥ë…„ ì†Œìƒê³µì¸
- ë°”ë¹ ì„œ ì§ì ‘ ì„¸íŒ…í•  ì‹œê°„ì´ ì—†ëŠ” 1ì¸ ì‚¬ì—…ì
- ë¹ ë¥´ê²Œ ì‹œì‘í•˜ê³  ì‹¶ì€ ì‹ ê·œ ì…€ëŸ¬

[í”„ë¡œëª¨ì…˜]
- Pro í”Œëœ 3ê°œì›” ê²°ì œ ì‹œ ì„¸íŒ… ëŒ€í–‰ ë¬´ë£Œ
- ì²« 100ëª… í•œì • 30,000ì› íŠ¹ê°€
```

### 9.5 ì—ì´ì „ì‹œ ì œíœ´ (í™”ì´íŠ¸ë¼ë²¨)

```
[Agency í”Œëœ ìƒì„¸]

ëŒ€ìƒ: ë§ˆì¼€íŒ… ì—ì´ì „ì‹œ, ì›¹ì—ì´ì „ì‹œ, SNS ê´€ë¦¬ ëŒ€í–‰ì‚¬

ê°€ê²©: ì›” 29,900ì› (ê¸°ë³¸ 5ê°œ ìƒµ í¬í•¨)
      + ìƒµ ì¶”ê°€: ê°œë‹¹ ì›” 5,000ì›

ê¸°ëŠ¥:
1. í™”ì´íŠ¸ë¼ë²¨
   - ì»¤ìŠ¤í…€ ë„ë©”ì¸ (replies.agency.com)
   - ë¡œê³  ë³€ê²½
   - ë¸Œëœë“œ ì»¬ëŸ¬ ë³€ê²½

2. ë©€í‹°ìƒµ ê´€ë¦¬
   - í†µí•© ëŒ€ì‹œë³´ë“œ
   - ìƒµë³„ ê°œë³„ ë¡œê·¸ì¸ ì œê³µ
   - ê¶Œí•œ ê´€ë¦¬ (Admin/Manager/Viewer)

3. ë¦¬ì…€ëŸ¬ ë§ˆì§„
   - íŒŒíŠ¸ë„ˆ ê°€ê²©: ì›” 7,000ì›/ìƒµ
   - ê¶Œì¥ íŒë§¤ê°€: ì›” 15,000ì›/ìƒµ
   - ë§ˆì§„: 8,000ì›/ìƒµ

4. ì „ë‹´ ì§€ì›
   - ìŠ¬ë™ ì±„ë„ ì§€ì›
   - ìš°ì„  ê¸°ëŠ¥ ê°œë°œ ìš”ì²­
   - ê³µë™ ë§ˆì¼€íŒ…

[ì œíœ´ í”„ë¡œì„¸ìŠ¤]
1. ì œíœ´ ì‹ ì²­ í¼ ì‘ì„±
2. ë¯¸íŒ… (Zoom 30ë¶„)
3. ë°ëª¨ ê³„ì • ë°œê¸‰
4. ê³„ì•½ì„œ ì²´ê²°
5. í™”ì´íŠ¸ë¼ë²¨ ì„¸íŒ… (3ì˜ì—…ì¼)
6. ëŸ°ì¹­
```

---

## 10. 24ì‹œê°„ ì°©ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ê°œë°œ í™˜ê²½ (2ì‹œê°„)

| ìˆœì„œ | ì‘ì—… | ìƒì„¸ | ì™„ë£Œ |
|------|------|------|------|
| 1 | ì„œë²„ ì„¸íŒ… | ê°€ë¹„ì•„/ì¹´í˜24/AWS ì„œë²„ 1ëŒ€ ì„ëŒ€ (Ubuntu 22.04) | â˜ |
| 2 | PHP ì„¤ì¹˜ | PHP 8.2, Composer, Laravel 10 | â˜ |
| 3 | Java ì„¤ì¹˜ | JDK 17, Gradle, Spring Boot 3.x | â˜ |
| 4 | DB ì„¤ì¹˜ | MySQL 8.0 ë˜ëŠ” MariaDB 10.6 | â˜ |
| 5 | Redis ì„¤ì¹˜ | Redis 7.x, redis-cli í…ŒìŠ¤íŠ¸ | â˜ |
| 6 | Nginx ì„¤ì • | ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ, SSL (Let's Encrypt) | â˜ |

### Phase 2: Meta ê°œë°œì ì„¤ì • (2ì‹œê°„)

| ìˆœì„œ | ì‘ì—… | ìƒì„¸ | ì™„ë£Œ |
|------|------|------|------|
| 1 | Facebook ê°œë°œì ê³„ì • | developers.facebook.com ê°€ì… | â˜ |
| 2 | ì•± ìƒì„± | Business íƒ€ì… ì•± ìƒì„± | â˜ |
| 3 | Instagram Basic Display | ì œí’ˆ ì¶”ê°€ | â˜ |
| 4 | Instagram Graph API | Messaging ê¶Œí•œ ìš”ì²­ | â˜ |
| 5 | ì›¹í›… URL ì„¤ì • | Callback URL ë“±ë¡ | â˜ |
| 6 | Verify Token ì„¤ì • | ëœë¤ í† í° ìƒì„± ë° ì €ì¥ | â˜ |

### Phase 3: DB ìŠ¤í‚¤ë§ˆ ìƒì„± (1ì‹œê°„)

| ìˆœì„œ | ì‘ì—… | ìƒì„¸ | ì™„ë£Œ |
|------|------|------|------|
| 1 | DB ìƒì„± | `CREATE DATABASE autoreplyx;` | â˜ |
| 2 | users í…Œì´ë¸” | ìœ„ ìŠ¤í‚¤ë§ˆ ì‹¤í–‰ | â˜ |
| 3 | channels í…Œì´ë¸” | ìœ„ ìŠ¤í‚¤ë§ˆ ì‹¤í–‰ | â˜ |
| 4 | auto_rules í…Œì´ë¸” | ìœ„ ìŠ¤í‚¤ë§ˆ ì‹¤í–‰ | â˜ |
| 5 | message_logs í…Œì´ë¸” | ìœ„ ìŠ¤í‚¤ë§ˆ ì‹¤í–‰ | â˜ |
| 6 | ë‚˜ë¨¸ì§€ í…Œì´ë¸” | ìœ„ ìŠ¤í‚¤ë§ˆ ì‹¤í–‰ | â˜ |

### Phase 4: ê¸°ë³¸ ì½”ë“œ ì‘ì„± (3ì‹œê°„)

| ìˆœì„œ | ì‘ì—… | ìƒì„¸ | ì™„ë£Œ |
|------|------|------|------|
| 1 | Laravel í”„ë¡œì íŠ¸ | `laravel new autoreplyx-api` | â˜ |
| 2 | ì›¹í›… ë¼ìš°íŠ¸ | `Route::match(['get','post'], '/webhook/instagram')` | â˜ |
| 3 | ì›¹í›… ì»¨íŠ¸ë¡¤ëŸ¬ | ê²€ì¦/ìˆ˜ì‹  ë¡œì§ êµ¬í˜„ | â˜ |
| 4 | Spring Boot í”„ë¡œì íŠ¸ | Worker í”„ë¡œì íŠ¸ ìƒì„± | â˜ |
| 5 | ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ | Redis/RabbitMQ ë¦¬ìŠ¤ë„ˆ | â˜ |
| 6 | ê·œì¹™ì—”ì§„ ê¸°ë³¸ | RuleEngine í´ë˜ìŠ¤ | â˜ |

### Phase 5: í…ŒìŠ¤íŠ¸ ë„êµ¬ ì¤€ë¹„ (1ì‹œê°„)

| ìˆœì„œ | ì‘ì—… | ìƒì„¸ | ì™„ë£Œ |
|------|------|------|------|
| 1 | Postman | ì»¬ë ‰ì…˜ ìƒì„±, ì›¹í›… í…ŒìŠ¤íŠ¸ í™˜ê²½ | â˜ |
| 2 | ngrok | ë¡œì»¬ í„°ë„ë§ (ê°œë°œìš© ì›¹í›… í…ŒìŠ¤íŠ¸) | â˜ |
| 3 | Meta ì›¹í›… í…ŒìŠ¤í„° | ê°œë°œì ì½˜ì†”ì—ì„œ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ë°œì†¡ | â˜ |
| 4 | Redis CLI | í ëª¨ë‹ˆí„°ë§ | â˜ |
| 5 | MySQL Workbench | ë°ì´í„° í™•ì¸ | â˜ |

### Phase 6: ê¸°ë³¸ ê·œì¹™ ìƒì„± (30ë¶„)

| ìˆœì„œ | ê·œì¹™ëª… | í‚¤ì›Œë“œ | ì‘ë‹µ | ì™„ë£Œ |
|------|--------|--------|------|------|
| 1 | ì˜ì—…ì‹œê°„ | ì˜ì—…ì‹œê°„ | ì˜ì—…ì‹œê°„ì€ [ì‹œê°„]ì…ë‹ˆë‹¤. | â˜ |
| 2 | ìœ„ì¹˜ | ìœ„ì¹˜, ì£¼ì†Œ, ì–´ë”” | ì €í¬ ìœ„ì¹˜ëŠ” [ì£¼ì†Œ]ì…ë‹ˆë‹¤. | â˜ |
| 3 | ê°€ê²© | ê°€ê²©, ì–¼ë§ˆ | ê°€ê²©í‘œë¥¼ ë³´ë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤. | â˜ |
| 4 | ì˜ˆì•½ | ì˜ˆì•½ | ì˜ˆì•½ì€ ë§í¬ë¥¼ í†µí•´ ê°€ëŠ¥í•©ë‹ˆë‹¤. [URL] | â˜ |
| 5 | ìš´ì˜ì‹œê°„ì™¸ | (ì‹œê°„ëŒ€ ì¡°ê±´) | í˜„ì¬ ìš´ì˜ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤. ë‚´ì¼ ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤. | â˜ |

### Phase 7: E2E í…ŒìŠ¤íŠ¸ (1ì‹œê°„)

| ìˆœì„œ | í…ŒìŠ¤íŠ¸ | ì˜ˆìƒ ê²°ê³¼ | ì™„ë£Œ |
|------|--------|----------|------|
| 1 | ì›¹í›… ê²€ì¦ | challenge ë°˜í™˜ | â˜ |
| 2 | í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ìˆ˜ì‹  | webhook_events ì €ì¥ | â˜ |
| 3 | ë©”ì‹œì§€ í í‘¸ì‹œ | Redisì— ë©”ì‹œì§€ ì¡´ì¬ | â˜ |
| 4 | Worker ì†Œë¹„ | ë¡œê·¸ ì¶œë ¥ í™•ì¸ | â˜ |
| 5 | ê·œì¹™ ë§¤ì¹­ | matched_rule_id í™•ì¸ | â˜ |
| 6 | ì‘ë‹µ ì „ì†¡ | Instagram DM ë„ì°© í™•ì¸ | â˜ |
| 7 | ë¡œê·¸ ì €ì¥ | message_logs ë ˆì½”ë“œ í™•ì¸ | â˜ |

### Phase 8: í”„ë¡ íŠ¸ì—”ë“œ ì—°ê²° (1ì‹œê°„)

| ìˆœì„œ | ì‘ì—… | ìƒì„¸ | ì™„ë£Œ |
|------|------|------|------|
| 1 | API URL ì„¤ì • | `.env` íŒŒì¼ì— API ì—”ë“œí¬ì¸íŠ¸ | â˜ |
| 2 | ë¡œê·¸ì¸ ì—°ë™ | Login.tsx â†’ API í˜¸ì¶œ | â˜ |
| 3 | ëŒ€ì‹œë³´ë“œ ì—°ë™ | Dashboard.tsx â†’ stats API | â˜ |
| 4 | ê·œì¹™ ì—°ë™ | Rules.tsx â†’ CRUD API | â˜ |
| 5 | ë¡œê·¸ ì—°ë™ | Logs.tsx â†’ logs API | â˜ |
| 6 | ë¹Œë“œ í…ŒìŠ¤íŠ¸ | `npm run build` ì„±ê³µ í™•ì¸ | â˜ |

---

## ë¶€ë¡ A: í™˜ê²½ë³€ìˆ˜ ì„¤ì •

### Laravel (.env)

```env
APP_NAME=AutoReplyX
APP_ENV=production
APP_KEY=base64:xxxxx
APP_DEBUG=false
APP_URL=https://api.autoreplyx.com

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=autoreplyx
DB_USERNAME=autoreplyx_user
DB_PASSWORD=secure_password

REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

# Instagram
INSTAGRAM_APP_ID=123456789
INSTAGRAM_APP_SECRET=abc123def456
INSTAGRAM_VERIFY_TOKEN=my_secure_verify_token

# OpenAI
OPENAI_API_KEY=sk-xxxxx

# JWT
JWT_SECRET=your-jwt-secret
JWT_TTL=60

# Mail
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=noreply@autoreplyx.com
MAIL_PASSWORD=app_password
```

### Spring Boot (application.yml)

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/autoreplyx
    username: autoreplyx_user
    password: secure_password

  redis:
    host: localhost
    port: 6379

  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest

openai:
  api-key: sk-xxxxx
  model: gpt-3.5-turbo
  max-tokens: 200

instagram:
  api-url: https://graph.facebook.com/v18.0
```

---

## ë¶€ë¡ B: Nginx ì„¤ì •

```nginx
# /etc/nginx/sites-available/autoreplyx

server {
    listen 80;
    server_name api.autoreplyx.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name api.autoreplyx.com;

    ssl_certificate /etc/letsencrypt/live/api.autoreplyx.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.autoreplyx.com/privkey.pem;

    root /var/www/autoreplyx/public;
    index index.php;

    # API ìš”ì²­
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    # ì›¹í›… ì „ìš© (ë¹ ë¥¸ ì‘ë‹µ)
    location /api/webhook {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root/index.php;
        include fastcgi_params;

        # íƒ€ì„ì•„ì›ƒ ì„¤ì •
        fastcgi_read_timeout 5s;
    }
}

# í”„ë¡ íŠ¸ì—”ë“œ
server {
    listen 443 ssl http2;
    server_name app.autoreplyx.com;

    ssl_certificate /etc/letsencrypt/live/app.autoreplyx.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/app.autoreplyx.com/privkey.pem;

    root /var/www/autoreplyx-frontend/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

---

## ë¶€ë¡ C: í”„ë¡ íŠ¸ì—”ë“œ API ì—°ë™ ì½”ë“œ

### API Client (src/lib/api.ts)

```typescript
import axios from 'axios';

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'https://api.autoreplyx.com/api',
  headers: {
    'Content-Type': 'application/json',
  },
});

// ì¸í„°ì…‰í„°: í† í° ì¶”ê°€
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('access_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// ì¸í„°ì…‰í„°: 401 ì²˜ë¦¬
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('access_token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default api;

// API í•¨ìˆ˜ë“¤
export const authAPI = {
  login: (email: string, password: string) =>
    api.post('/auth/login', { email, password }),
  register: (data: any) =>
    api.post('/auth/register', data),
  logout: () =>
    api.post('/auth/logout'),
};

export const rulesAPI = {
  list: () => api.get('/rules'),
  create: (data: any) => api.post('/rules', data),
  update: (id: number, data: any) => api.put(`/rules/${id}`, data),
  delete: (id: number) => api.delete(`/rules/${id}`),
  test: (message: string, channel: string) =>
    api.post('/ai/test-message', { message, channel }),
};

export const dashboardAPI = {
  stats: () => api.get('/dashboard/stats'),
};

export const logsAPI = {
  list: (params: any) => api.get('/logs', { params }),
  export: (params: any) => api.get('/logs/export', { params, responseType: 'blob' }),
};

export const reservationsAPI = {
  list: (params: any) => api.get('/reservations', { params }),
  updateStatus: (id: number, status: string) =>
    api.put(`/reservations/${id}/status`, { status }),
};

export const profileAPI = {
  get: () => api.get('/profile'),
  update: (data: any) => api.put('/profile', data),
};

export const channelsAPI = {
  list: () => api.get('/channels'),
  connectInstagram: (code: string) =>
    api.post('/channels/instagram/connect', { code }),
  disconnect: (channel: string) =>
    api.delete(`/channels/${channel}`),
};
```

---

**ë¬¸ì„œ ì‘ì„± ì™„ë£Œ**

ì´ ë¬¸ì„œëŠ” AutoReplyX ì„œë¹„ìŠ¤ì˜ ì „ì²´ ê¸°íšÂ·ì„¤ê³„Â·ê°œë°œÂ·ëŸ°ì¹­ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
ì¦‰ì‹œ ê°œë°œì— ì°©ìˆ˜í•  ìˆ˜ ìˆë„ë¡ ìƒì„¸í•˜ê²Œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
